{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _styledComponents = _interopRequireWildcard(require(\"styled-components\"));\n\nvar _tsEbml = require(\"ts-ebml\");\n\nvar _unsupportedView = _interopRequireDefault(require(\"./defaults/unsupported-view\"));\n\nvar _errorView = _interopRequireDefault(require(\"./defaults/error-view\"));\n\nvar _disconnectedView = _interopRequireDefault(require(\"./defaults/disconnected-view\"));\n\nvar _loadingView = _interopRequireDefault(require(\"./defaults/loading-view\"));\n\nvar _switchCameraView = _interopRequireDefault(require(\"./defaults/switch-camera-view\"));\n\nvar _renderActions = _interopRequireDefault(require(\"./defaults/render-actions\"));\n\nvar _getVideoInfo = _interopRequireWildcard(require(\"./get-video-info\"));\n\nvar _customErrors = require(\"./custom-errors\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar MIME_TYPES = ['video/webm;codecs=\"vp8,opus\"', 'video/webm;codecs=h264', 'video/webm;codecs=vp9', 'video/webm', 'video/mp4'];\nvar CONSTRAINTS = {\n  audio: true,\n  video: true\n};\n\nvar Wrapper = _styledComponents[\"default\"].div.withConfig({\n  displayName: \"video-recorder__Wrapper\",\n  componentId: \"sc-7k20rv-0\"\n})([\"position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;overflow:hidden;min-height:300px;background-color:#000;color:white;box-sizing:border-box;*{box-sizing:inherit;}\"]);\n\nvar CameraView = _styledComponents[\"default\"].div.withConfig({\n  displayName: \"video-recorder__CameraView\",\n  componentId: \"sc-7k20rv-1\"\n})([\"width:100%;height:100%;\"]);\n\nvar Video = _styledComponents[\"default\"].video.withConfig({\n  displayName: \"video-recorder__Video\",\n  componentId: \"sc-7k20rv-2\"\n})([\"position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;\", \";\", \";\"], function (props) {\n  return props.isFlipped && (0, _styledComponents.css)([\"transform:translate(-50%,-50%) scaleX(-1);\"]);\n}, function (props) {\n  return props.onClick && (0, _styledComponents.css)([\"cursor:pointer;\"]);\n});\n\nvar VideoRecorder = /*#__PURE__*/function (_Component) {\n  _inherits(VideoRecorder, _Component);\n\n  var _super = _createSuper(VideoRecorder);\n\n  function VideoRecorder() {\n    var _this;\n\n    _classCallCheck(this, VideoRecorder);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"videoInput\", /*#__PURE__*/_react[\"default\"].createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"isComponentUnmounted\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"timeSinceInactivity\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isRecording: false,\n      isCameraOn: false,\n      isConnecting: false,\n      isReplayingVideo: false,\n      isReplayVideoMuted: true,\n      thereWasAnError: false,\n      error: null,\n      streamIsReady: false,\n      isInlineRecordingSupported: null,\n      isVideoInputSupported: null,\n      stream: undefined,\n      currentDeviceId: null,\n      availableDeviceIds: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"turnOnCamera\", function () {\n      var deviceId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n      if (_this.props.onTurnOnCamera) {\n        _this.props.onTurnOnCamera();\n      }\n\n      navigator.mediaDevices.enumerateDevices().then(function (mediaDevices) {\n        var videoDevices = mediaDevices.filter(function (x) {\n          return x.kind === 'videoinput';\n        });\n\n        if (deviceId && videoDevices[0] && videoDevices.find(function (x) {\n          return x.deviceId;\n        }) === undefined) {\n          return _this.handleError(new _customErrors.ReactVideoRecorderDeviceUnavailableError());\n        }\n\n        var currentDeviceId = typeof deviceId === 'string' ? deviceId : videoDevices[0].deviceId;\n\n        _this.setState({\n          isConnecting: true,\n          isReplayingVideo: false,\n          thereWasAnError: false,\n          currentDeviceId: currentDeviceId,\n          availableDeviceIds: videoDevices.map(function (x) {\n            return x.deviceId;\n          }),\n          error: null\n        });\n\n        var fallbackContraints = {\n          audio: true,\n          video: true\n        };\n\n        var currentConstraints = _objectSpread(_objectSpread({}, _this.props.constraints), {}, {\n          video: {\n            deviceId: {\n              exact: currentDeviceId\n            }\n          }\n        });\n\n        navigator.mediaDevices.getUserMedia(currentConstraints)[\"catch\"](function (err) {\n          // there's a bug in chrome in some windows computers where using `ideal` in the constraints throws a NotReadableError\n          if (err.name === 'NotReadableError' || err.name === 'OverconstrainedError') {\n            console.warn(\"Got \".concat(err.name, \", trying getUserMedia again with fallback constraints\"));\n            return navigator.mediaDevices.getUserMedia(fallbackContraints);\n          }\n\n          throw err;\n        }).then(_this.handleSuccess)[\"catch\"](_this.handleError);\n      })[\"catch\"](_this.handleError);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSwitchCamera\", function () {\n      if (_this.props.onSwitchCamera) {\n        _this.props.onSwitchCamera();\n      }\n\n      var _this$state = _this.state,\n          currentDeviceId = _this$state.currentDeviceId,\n          availableDeviceIds = _this$state.availableDeviceIds; // Stop media tracks\n\n      _this.stream && _this.stream.getTracks().forEach(function (stream) {\n        return stream.stop();\n      });\n      var index = availableDeviceIds.findIndex(function (x) {\n        return x === currentDeviceId;\n      });\n      var maxIndex = availableDeviceIds.length - 1;\n\n      if (index < 0) {\n        return _this.handleError(new _customErrors.ReactVideoRecorderDeviceUnavailableError());\n      }\n\n      if (index + 1 > maxIndex) return _this.turnOnCamera(availableDeviceIds[0]);\n      return _this.turnOnCamera(availableDeviceIds[index + 1]);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"turnOffCamera\", function () {\n      if (_this.props.onTurnOffCamera) {\n        _this.props.onTurnOffCamera();\n      }\n\n      _this.stream && _this.stream.getTracks().forEach(function (stream) {\n        return stream.stop();\n      });\n\n      _this.setState({\n        isCameraOn: false\n      });\n\n      clearInterval(_this.inactivityTimer);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSuccess\", function (stream) {\n      // Since handleSuccess is an async function, we may be in a situation where this was called after the\n      // component was unmounted\n      if (_this.isComponentUnmounted) {\n        return;\n      }\n\n      _this.stream = stream;\n\n      _this.setState({\n        isCameraOn: true,\n        stream: stream\n      });\n\n      if (_this.props.onCameraOn) {\n        _this.props.onCameraOn();\n      }\n\n      if (window.URL) {\n        _this.cameraVideo.srcObject = stream;\n      } else {\n        _this.cameraVideo.src = stream;\n      } // there is probably a better way\n      // but this makes sure the start recording button\n      // gives the stream a couple miliseconds to be ready\n\n\n      setTimeout(function () {\n        _this.setState({\n          isConnecting: false,\n          streamIsReady: true\n        });\n      }, 200);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleError\", function (err) {\n      var onError = _this.props.onError;\n\n      if (onError) {\n        onError(err);\n      }\n\n      if (_this.isComponentUnmounted) {\n        return;\n      }\n\n      console.error('Captured error', err);\n      clearTimeout(_this.timeLimitTimeout);\n\n      _this.setState({\n        isConnecting: _this.state.isConnecting && false,\n        isRecording: false,\n        thereWasAnError: true,\n        error: err\n      });\n\n      if (_this.state.isCameraOn) {\n        _this.turnOffCamera();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDataIssue\", function (event) {\n      var error = new _customErrors.ReactVideoRecorderDataIssueError(event);\n      console.error(error.message, event);\n\n      _this.handleError(error);\n\n      return false;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getMimeType\", function () {\n      if (_this.props.mimeType) {\n        return _this.props.mimeType;\n      }\n\n      var mimeType = window.MediaRecorder.isTypeSupported ? MIME_TYPES.find(window.MediaRecorder.isTypeSupported) : 'video/webm';\n      return _this.mediaRecorder && _this.mediaRecorder.mimeType || mimeType || '';\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isDataHealthOK\", function (event) {\n      if (!event.data) return _this.handleDataIssue(event);\n      var chunkSize = _this.props.chunkSize;\n      var dataCheckInterval = 2000 / chunkSize; // in some browsers (FF/S), data only shows up\n      // after a certain amount of time ~everyt 2 seconds\n\n      var blobCount = _this.recordedBlobs.length;\n\n      if (blobCount > dataCheckInterval && blobCount % dataCheckInterval === 0) {\n        var blob = new window.Blob(_this.recordedBlobs, {\n          type: _this.getMimeType()\n        });\n        if (blob.size <= 0) return _this.handleDataIssue(event);\n      }\n\n      return true;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"tryToUnmuteReplayVideo\", function () {\n      var video = _this.replayVideo;\n      video.muted = false;\n      var playPromise = video.play();\n\n      if (!playPromise) {\n        video.muted = true;\n        return;\n      }\n\n      playPromise.then(function () {\n        _this.setState({\n          isReplayVideoMuted: false\n        }); // fixes bug where seeking control during autoplay is not available until the video is almost completely played through\n\n\n        if (_this.props.replayVideoAutoplayAndLoopOff) {\n          video.pause();\n          video.loop = false;\n        }\n      })[\"catch\"](function (err) {\n        console.warn('Could not autoplay replay video', err);\n        video.muted = true;\n        return video.play();\n      })[\"catch\"](function (err) {\n        console.warn('Could play muted replay video after failed autoplay', err);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDataAvailable\", function (event) {\n      if (_this.isDataHealthOK(event)) {\n        _this.recordedBlobs.push(event.data);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStopRecording\", function () {\n      if (_this.props.onStopRecording) {\n        _this.props.onStopRecording();\n      }\n\n      if (!_this.mediaRecorder) {\n        _this.handleError(new _customErrors.ReactVideoRecorderMediaRecorderUnavailableError());\n\n        return;\n      }\n\n      _this.mediaRecorder.stop();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handlePauseRecording\", function () {\n      if (_this.props.onPauseRecording) {\n        _this.props.onPauseRecording();\n      }\n\n      if (!_this.mediaRecorder) {\n        _this.handleError(new _customErrors.ReactVideoRecorderMediaRecorderUnavailableError());\n\n        return;\n      }\n\n      _this.mediaRecorder.pause();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleResumeRecording\", function () {\n      if (_this.props.onResumeRecording) {\n        _this.props.onResumeRecording();\n      }\n\n      if (!_this.mediaRecorder) {\n        _this.handleError(new _customErrors.ReactVideoRecorderMediaRecorderUnavailableError());\n\n        return;\n      }\n\n      _this.mediaRecorder.resume();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStartRecording\", function () {\n      if (_this.props.onStartRecording) {\n        _this.props.onStartRecording();\n      }\n\n      _this.setState({\n        isRunningCountdown: true,\n        isReplayingVideo: false\n      });\n\n      setTimeout(function () {\n        return _this.startRecording();\n      }, _this.props.countdownTime);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"startRecording\", function () {\n      (0, _getVideoInfo.captureThumb)(_this.cameraVideo).then(function (thumbnail) {\n        _this.thumbnail = thumbnail;\n        _this.recordedBlobs = [];\n        var options = {\n          mimeType: _this.getMimeType()\n        };\n\n        try {\n          _this.setState({\n            isRunningCountdown: false,\n            isRecording: true\n          });\n\n          _this.startedAt = new Date().getTime();\n          _this.mediaRecorder = new window.MediaRecorder(_this.stream, options);\n\n          _this.mediaRecorder.addEventListener('stop', _this.handleStop);\n\n          _this.mediaRecorder.addEventListener('error', _this.handleError);\n\n          _this.mediaRecorder.addEventListener('dataavailable', _this.handleDataAvailable);\n\n          var _this$props = _this.props,\n              timeLimit = _this$props.timeLimit,\n              chunkSize = _this$props.chunkSize,\n              dataAvailableTimeout = _this$props.dataAvailableTimeout;\n\n          _this.mediaRecorder.start(chunkSize); // collect 10ms of data\n\n\n          if (timeLimit) {\n            _this.timeLimitTimeout = setTimeout(function () {\n              _this.handleStopRecording();\n            }, timeLimit);\n          } // mediaRecorder.ondataavailable should be called every 10ms,\n          // as that's what we're passing to mediaRecorder.start() above\n\n\n          if (Number.isInteger(dataAvailableTimeout)) {\n            setTimeout(function () {\n              if (_this.recordedBlobs.length === 0) {\n                _this.handleError(new _customErrors.ReactVideoRecorderDataAvailableTimeoutError(dataAvailableTimeout));\n              }\n            }, dataAvailableTimeout);\n          }\n        } catch (err) {\n          console.error(\"Couldn't create MediaRecorder\", err, options);\n\n          _this.handleError(err);\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStop\", function (event) {\n      var endedAt = new Date().getTime();\n\n      if (!_this.recordedBlobs || _this.recordedBlobs.length <= 0) {\n        var error = new _customErrors.ReactVideoRecorderRecordedBlobsUnavailableError(event);\n        console.error(error.message, event);\n\n        _this.handleError(error);\n\n        return;\n      }\n\n      clearTimeout(_this.timeLimitTimeout);\n      var videoBlob = _this.recordedBlobs.length === 1 ? _this.recordedBlobs[0] : new window.Blob(_this.recordedBlobs, {\n        type: _this.getMimeType()\n      });\n      var thumbnailBlob = _this.thumbnail;\n      var startedAt = _this.startedAt;\n      var duration = endedAt - startedAt; // if this gets executed too soon, the last chunk of data is lost on FF\n\n      _this.mediaRecorder.ondataavailable = null;\n\n      _this.fixVideoMetadata(videoBlob).then(function (fixedVideoBlob) {\n        _this.setState({\n          isRecording: false,\n          isReplayingVideo: true,\n          isReplayVideoMuted: true,\n          fixedVideoBlob: fixedVideoBlob,\n          videoUrl: window.URL.createObjectURL(fixedVideoBlob)\n        });\n\n        _this.turnOffCamera();\n\n        _this.props.onRecordingComplete(fixedVideoBlob, startedAt, thumbnailBlob, duration);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fixVideoMetadata\", function (rawVideoBlob) {\n      var _Blob$prototype, _Blob$prototype$array;\n\n      var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n      if (isSafari) {\n        return Promise.resolve(rawVideoBlob);\n      } // see https://stackoverflow.com/a/63568311\n\n\n      (_Blob$prototype$array = (_Blob$prototype = Blob.prototype).arrayBuffer) !== null && _Blob$prototype$array !== void 0 ? _Blob$prototype$array : _Blob$prototype.arrayBuffer = function () {\n        return new Response(this).arrayBuffer();\n      };\n      return rawVideoBlob.arrayBuffer().then(function (buffer) {\n        var _elements;\n\n        var decoder = new _tsEbml.Decoder();\n        var elements = decoder.decode(buffer); // see https://github.com/legokichi/ts-ebml/issues/33#issuecomment-888800828\n\n        var validEmlType = ['m', 'u', 'i', 'f', 's', '8', 'b', 'd'];\n        elements = (_elements = elements) === null || _elements === void 0 ? void 0 : _elements.filter(function (elm) {\n          return validEmlType.includes(elm.type);\n        });\n        var reader = new _tsEbml.Reader();\n        reader.logging = false;\n        reader.drop_default_duration = false;\n        elements.forEach(function (element) {\n          return reader.read(element);\n        });\n        reader.stop();\n\n        var seekableMetadata = _tsEbml.tools.makeMetadataSeekable(reader.metadatas, reader.duration, reader.cues);\n\n        var blobBody = buffer.slice(reader.metadataSize);\n        var result = new Blob([seekableMetadata, blobBody], {\n          type: rawVideoBlob.type\n        });\n        return result;\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleVideoSelected\", function (e) {\n      if (_this.state.isReplayingVideo) {\n        _this.setState({\n          isReplayingVideo: false\n        });\n      }\n\n      var files = e.target.files || e.dataTransfer.files;\n      if (files.length === 0) return;\n      var startedAt = new Date().getTime();\n      var video = files[0];\n      e.target.value = null;\n      var extension = video.type === 'video/quicktime' ? 'mov' : undefined;\n      (0, _getVideoInfo[\"default\"])(video).then(function (_ref) {\n        var duration = _ref.duration,\n            thumbnail = _ref.thumbnail;\n\n        _this.setState({\n          isRecording: false,\n          isReplayingVideo: true,\n          isReplayVideoMuted: true,\n          videoBlob: video,\n          videoUrl: window.URL.createObjectURL(video)\n        });\n\n        _this.props.onRecordingComplete(video, startedAt, thumbnail, duration, extension);\n      })[\"catch\"](function (err) {\n        _this.handleError(err);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOpenVideoInput\", function () {\n      if (_this.props.onOpenVideoInput) {\n        _this.props.onOpenVideoInput();\n      }\n\n      _this.videoInput.current.value = null;\n\n      _this.videoInput.current.click(); // fixes a bug on iPhone where it doesn't save the recorded video on the second time (if you press the 'Use another video' button)\n\n\n      _this.videoInput.current.addEventListener('change', _this.handleVideoSelected);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStopReplaying\", function () {\n      if (_this.props.onStopReplaying) {\n        _this.props.onStopReplaying();\n      }\n\n      if (_this.props.useVideoInput && _this.props.isOnInitially) {\n        return _this.handleOpenVideoInput();\n      }\n\n      _this.setState({\n        isReplayingVideo: false\n      });\n\n      if (_this.state.isInlineRecordingSupported && _this.props.isOnInitially) {\n        _this.turnOnCamera();\n      } else if (_this.state.isVideoInputSupported && _this.props.isOnInitially) {\n        _this.handleOpenVideoInput();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReplayVideoClick\", function () {\n      if (_this.replayVideo.paused && !_this.props.showReplayControls) {\n        _this.replayVideo.play();\n      } // fixes bug where seeking control during autoplay is not available until the video is almost completely played through\n\n\n      if (!_this.props.replayVideoAutoplayAndLoopOff) {\n        _this.setState({\n          isReplayVideoMuted: !_this.state.isReplayVideoMuted\n        });\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(VideoRecorder, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var isInlineRecordingSupported = !!window.MediaRecorder && !!navigator.mediaDevices;\n      var isVideoInputSupported = document.createElement('input').capture !== undefined;\n      this.setState({\n        isInlineRecordingSupported: isInlineRecordingSupported,\n        isVideoInputSupported: isVideoInputSupported\n      }, function () {\n        if (_this2.props.useVideoInput && _this2.props.isOnInitially) {\n          _this2.handleOpenVideoInput();\n        } else if (_this2.state.isInlineRecordingSupported && _this2.props.isOnInitially) {\n          _this2.turnOnCamera();\n        } else if (_this2.state.isVideoInputSupported && _this2.props.isOnInitially) {\n          _this2.handleOpenVideoInput();\n        }\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (this.replayVideo && this.state.isReplayingVideo && !prevState.isReplayingVideo) {\n        this.tryToUnmuteReplayVideo();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.turnOffCamera();\n      this.isComponentUnmounted = true;\n    }\n  }, {\n    key: \"renderCameraView\",\n    value: function renderCameraView() {\n      var _this3 = this;\n\n      var _this$props2 = this.props,\n          cameraViewClassName = _this$props2.cameraViewClassName,\n          showReplayControls = _this$props2.showReplayControls,\n          videoControlsList = _this$props2.videoControlsList,\n          disablePictureInPicture = _this$props2.disablePictureInPicture,\n          replayVideoAutoplayAndLoopOff = _this$props2.replayVideoAutoplayAndLoopOff,\n          renderDisconnectedView = _this$props2.renderDisconnectedView,\n          renderVideoInputView = _this$props2.renderVideoInputView,\n          renderUnsupportedView = _this$props2.renderUnsupportedView,\n          renderErrorView = _this$props2.renderErrorView,\n          renderLoadingView = _this$props2.renderLoadingView,\n          useVideoInput = _this$props2.useVideoInput,\n          videoClassName = _this$props2.videoClassName;\n      var _this$state2 = this.state,\n          isVideoInputSupported = _this$state2.isVideoInputSupported,\n          isReplayingVideo = _this$state2.isReplayingVideo,\n          isInlineRecordingSupported = _this$state2.isInlineRecordingSupported,\n          thereWasAnError = _this$state2.thereWasAnError,\n          error = _this$state2.error,\n          isCameraOn = _this$state2.isCameraOn,\n          isConnecting = _this$state2.isConnecting,\n          isReplayVideoMuted = _this$state2.isReplayVideoMuted,\n          isRecording = _this$state2.isRecording,\n          availableDeviceIds = _this$state2.availableDeviceIds;\n      var shouldUseVideoInput = useVideoInput || !isInlineRecordingSupported && isVideoInputSupported;\n      var videoInput = shouldUseVideoInput ? /*#__PURE__*/_react[\"default\"].createElement(\"input\", {\n        ref: this.videoInput,\n        key: \"videoInput\",\n        type: \"file\",\n        accept: \"video/*\",\n        capture: useVideoInput ? undefined : 'user',\n        style: {\n          display: 'none'\n        },\n        onChange: this.handleVideoSelected\n      }) : null;\n\n      if (isReplayingVideo) {\n        return /*#__PURE__*/_react[\"default\"].createElement(CameraView, {\n          key: \"replay\",\n          className: cameraViewClassName\n        }, /*#__PURE__*/_react[\"default\"].createElement(Video, {\n          ref: function ref(el) {\n            return _this3.replayVideo = el;\n          },\n          className: videoClassName,\n          src: this.state.videoUrl,\n          loop: true,\n          muted: isReplayVideoMuted,\n          playsInline: true,\n          autoPlay: !replayVideoAutoplayAndLoopOff,\n          controls: showReplayControls,\n          onClick: this.handleReplayVideoClick,\n          onDurationChange: this.handleDurationChange,\n          controlsList: videoControlsList,\n          disablePictureInPicture: disablePictureInPicture\n        }), videoInput);\n      }\n\n      if (shouldUseVideoInput) {\n        return renderVideoInputView({\n          videoInput: videoInput\n        });\n      }\n\n      if (!isInlineRecordingSupported) {\n        return renderUnsupportedView();\n      }\n\n      if (thereWasAnError) {\n        return renderErrorView({\n          error: error\n        });\n      }\n\n      if (isCameraOn) {\n        // Enable switch camera button, only if not recording and multiple video sources available\n        var switchCameraControl = availableDeviceIds && availableDeviceIds.length >= 2 && !isRecording ? /*#__PURE__*/_react[\"default\"].createElement(_switchCameraView[\"default\"], {\n          onClick: this.handleSwitchCamera\n        }) : null;\n        return /*#__PURE__*/_react[\"default\"].createElement(CameraView, {\n          key: \"camera\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(Video, {\n          isFlipped: this.props.isFlipped,\n          ref: function ref(el) {\n            return _this3.cameraVideo = el;\n          },\n          autoPlay: true,\n          muted: true,\n          playsInline: true\n        }), switchCameraControl);\n      }\n\n      if (isConnecting) {\n        return renderLoadingView();\n      }\n\n      return renderDisconnectedView();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$state3 = this.state,\n          isVideoInputSupported = _this$state3.isVideoInputSupported,\n          isInlineRecordingSupported = _this$state3.isInlineRecordingSupported,\n          thereWasAnError = _this$state3.thereWasAnError,\n          isRecording = _this$state3.isRecording,\n          isCameraOn = _this$state3.isCameraOn,\n          streamIsReady = _this$state3.streamIsReady,\n          isConnecting = _this$state3.isConnecting,\n          isRunningCountdown = _this$state3.isRunningCountdown,\n          isReplayingVideo = _this$state3.isReplayingVideo,\n          isReplayVideoMuted = _this$state3.isReplayVideoMuted;\n      var _this$props3 = this.props,\n          countdownTime = _this$props3.countdownTime,\n          timeLimit = _this$props3.timeLimit,\n          showReplayControls = _this$props3.showReplayControls,\n          replayVideoAutoplayAndLoopOff = _this$props3.replayVideoAutoplayAndLoopOff,\n          renderActions = _this$props3.renderActions,\n          t = _this$props3.t,\n          useVideoInput = _this$props3.useVideoInput,\n          wrapperClassName = _this$props3.wrapperClassName;\n      return /*#__PURE__*/_react[\"default\"].createElement(Wrapper, {\n        className: wrapperClassName\n      }, this.renderCameraView(), renderActions({\n        t: t,\n        isVideoInputSupported: isVideoInputSupported,\n        isInlineRecordingSupported: isInlineRecordingSupported,\n        thereWasAnError: thereWasAnError,\n        isRecording: isRecording,\n        isCameraOn: isCameraOn,\n        streamIsReady: streamIsReady,\n        isConnecting: isConnecting,\n        isRunningCountdown: isRunningCountdown,\n        isReplayingVideo: isReplayingVideo,\n        isReplayVideoMuted: isReplayVideoMuted,\n        countdownTime: countdownTime,\n        timeLimit: timeLimit,\n        showReplayControls: showReplayControls,\n        replayVideoAutoplayAndLoopOff: replayVideoAutoplayAndLoopOff,\n        useVideoInput: useVideoInput,\n        onTurnOnCamera: function onTurnOnCamera() {\n          return _this4.turnOnCamera();\n        },\n        onSwitchCamera: this.handleSwitchCamera,\n        onTurnOffCamera: this.turnOffCamera,\n        onOpenVideoInput: this.handleOpenVideoInput,\n        onStartRecording: this.handleStartRecording,\n        onStopRecording: this.handleStopRecording,\n        onPauseRecording: this.handlePauseRecording,\n        onResumeRecording: this.handleResumeRecording,\n        onStopReplaying: this.handleStopReplaying\n      }));\n    }\n  }]);\n\n  return VideoRecorder;\n}(_react.Component);\n\nexports[\"default\"] = VideoRecorder;\n\n_defineProperty(VideoRecorder, \"propTypes\", {\n  /** Whether or not to start the camera initially */\n  isOnInitially: _propTypes[\"default\"].bool,\n\n  /** Whether or not to display the video flipped (makes sense for user facing camera) */\n  isFlipped: _propTypes[\"default\"].bool,\n\n  /** Pass this if you want to force a specific mime-type for the video */\n  mimeType: _propTypes[\"default\"].string,\n\n  /** How much time to wait until it starts recording (in ms) */\n  countdownTime: _propTypes[\"default\"].number,\n\n  /** Use this if you want to set a time limit for the video (in ms) */\n  timeLimit: _propTypes[\"default\"].number,\n\n  /** Use this if you want to show play/pause/etc. controls on the replay video */\n  showReplayControls: _propTypes[\"default\"].bool,\n\n  /** Use this to turn off autoplay and looping of the replay video. It is recommended to also showReplayControls in order to play */\n  replayVideoAutoplayAndLoopOff: _propTypes[\"default\"].bool,\n\n  /** Use this if you want to customize the constraints passed to getUserMedia() */\n  constraints: _propTypes[\"default\"].shape({\n    audio: _propTypes[\"default\"].any,\n    video: _propTypes[\"default\"].any\n  }),\n  chunkSize: _propTypes[\"default\"].number,\n  dataAvailableTimeout: _propTypes[\"default\"].number,\n  useVideoInput: _propTypes[\"default\"].bool,\n\n  /** Use this to configure the replaying video element's controlslist attribute */\n  videoControlsList: _propTypes[\"default\"].string,\n\n  /** Use this to disable picture in picture mode on the replaying video element */\n  disablePictureInPicture: _propTypes[\"default\"].bool,\n  renderDisconnectedView: _propTypes[\"default\"].func,\n  renderLoadingView: _propTypes[\"default\"].func,\n  renderVideoInputView: _propTypes[\"default\"].func,\n  renderUnsupportedView: _propTypes[\"default\"].func,\n  renderErrorView: _propTypes[\"default\"].func,\n  renderActions: _propTypes[\"default\"].func,\n  cameraViewClassName: _propTypes[\"default\"].string,\n  videoClassName: _propTypes[\"default\"].string,\n  wrapperClassName: _propTypes[\"default\"].string,\n\n  /** Use this to localize the texts */\n  t: _propTypes[\"default\"].func,\n  onCameraOn: _propTypes[\"default\"].func,\n  onTurnOnCamera: _propTypes[\"default\"].func,\n  onSwitchCamera: _propTypes[\"default\"].func,\n  onTurnOffCamera: _propTypes[\"default\"].func,\n  onStartRecording: _propTypes[\"default\"].func,\n  onStopRecording: _propTypes[\"default\"].func,\n  onPauseRecording: _propTypes[\"default\"].func,\n  onResumeRecording: _propTypes[\"default\"].func,\n  onRecordingComplete: _propTypes[\"default\"].func,\n  onOpenVideoInput: _propTypes[\"default\"].func,\n  onStopReplaying: _propTypes[\"default\"].func,\n  onError: _propTypes[\"default\"].func\n});\n\n_defineProperty(VideoRecorder, \"defaultProps\", {\n  renderUnsupportedView: function renderUnsupportedView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_unsupportedView[\"default\"], null);\n  },\n  renderErrorView: function renderErrorView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_errorView[\"default\"], null);\n  },\n  renderVideoInputView: function renderVideoInputView(_ref2) {\n    var videoInput = _ref2.videoInput;\n    return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, videoInput);\n  },\n  renderDisconnectedView: function renderDisconnectedView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_disconnectedView[\"default\"], null);\n  },\n  renderLoadingView: function renderLoadingView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_loadingView[\"default\"], null);\n  },\n  t: function t(x) {\n    return x;\n  },\n  renderActions: _renderActions[\"default\"],\n  isFlipped: true,\n  countdownTime: 3000,\n  constraints: CONSTRAINTS,\n  chunkSize: 250,\n  dataAvailableTimeout: 500\n});","map":{"version":3,"sources":["/Users/arnabdhar/Desktop/meetingbuddy/node_modules/react-video-recorder/lib/video-recorder.js"],"names":["Object","defineProperty","exports","value","_react","_interopRequireWildcard","require","_propTypes","_interopRequireDefault","_styledComponents","_tsEbml","_unsupportedView","_errorView","_disconnectedView","_loadingView","_switchCameraView","_renderActions","_getVideoInfo","_customErrors","obj","__esModule","_getRequireWildcardCache","WeakMap","cache","_typeof","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","Symbol","iterator","constructor","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","getPrototypeOf","MIME_TYPES","CONSTRAINTS","audio","video","Wrapper","div","withConfig","displayName","componentId","CameraView","Video","isFlipped","css","onClick","VideoRecorder","_Component","_super","_this","_len","args","Array","_key","concat","createRef","isRecording","isCameraOn","isConnecting","isReplayingVideo","isReplayVideoMuted","thereWasAnError","error","streamIsReady","isInlineRecordingSupported","isVideoInputSupported","stream","undefined","currentDeviceId","availableDeviceIds","deviceId","onTurnOnCamera","navigator","mediaDevices","enumerateDevices","then","videoDevices","x","kind","find","handleError","ReactVideoRecorderDeviceUnavailableError","setState","map","fallbackContraints","currentConstraints","constraints","exact","getUserMedia","err","name","console","warn","handleSuccess","onSwitchCamera","_this$state","state","getTracks","stop","index","findIndex","maxIndex","turnOnCamera","onTurnOffCamera","clearInterval","inactivityTimer","isComponentUnmounted","onCameraOn","window","URL","cameraVideo","srcObject","src","setTimeout","onError","clearTimeout","timeLimitTimeout","turnOffCamera","event","ReactVideoRecorderDataIssueError","message","mimeType","MediaRecorder","isTypeSupported","mediaRecorder","data","handleDataIssue","chunkSize","dataCheckInterval","blobCount","recordedBlobs","blob","Blob","type","getMimeType","size","replayVideo","muted","playPromise","play","replayVideoAutoplayAndLoopOff","pause","loop","isDataHealthOK","onStopRecording","ReactVideoRecorderMediaRecorderUnavailableError","onPauseRecording","onResumeRecording","resume","onStartRecording","isRunningCountdown","startRecording","countdownTime","captureThumb","thumbnail","options","startedAt","getTime","addEventListener","handleStop","handleDataAvailable","_this$props","timeLimit","dataAvailableTimeout","start","handleStopRecording","Number","isInteger","ReactVideoRecorderDataAvailableTimeoutError","endedAt","ReactVideoRecorderRecordedBlobsUnavailableError","videoBlob","thumbnailBlob","duration","ondataavailable","fixVideoMetadata","fixedVideoBlob","videoUrl","createObjectURL","onRecordingComplete","rawVideoBlob","_Blob$prototype","_Blob$prototype$array","isSafari","test","userAgent","Promise","resolve","arrayBuffer","Response","buffer","_elements","decoder","Decoder","elements","decode","validEmlType","elm","includes","reader","Reader","logging","drop_default_duration","element","read","seekableMetadata","tools","makeMetadataSeekable","metadatas","cues","blobBody","slice","metadataSize","files","dataTransfer","extension","_ref","onOpenVideoInput","videoInput","current","click","handleVideoSelected","onStopReplaying","useVideoInput","isOnInitially","handleOpenVideoInput","paused","showReplayControls","componentDidMount","_this2","document","createElement","capture","componentDidUpdate","prevProps","prevState","tryToUnmuteReplayVideo","componentWillUnmount","renderCameraView","_this3","_this$props2","cameraViewClassName","videoControlsList","disablePictureInPicture","renderDisconnectedView","renderVideoInputView","renderUnsupportedView","renderErrorView","renderLoadingView","videoClassName","_this$state2","shouldUseVideoInput","ref","accept","style","display","onChange","className","el","playsInline","autoPlay","controls","handleReplayVideoClick","onDurationChange","handleDurationChange","controlsList","switchCameraControl","handleSwitchCamera","render","_this4","_this$state3","_this$props3","renderActions","t","wrapperClassName","handleStartRecording","handlePauseRecording","handleResumeRecording","handleStopReplaying","Component","bool","string","number","shape","any","func","_ref2","Fragment"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAAC,SAAD,CAAP,GAAqB,KAAK,CAA1B;;AAEA,IAAIE,MAAM,GAAGC,uBAAuB,CAACC,OAAO,CAAC,OAAD,CAAR,CAApC;;AAEA,IAAIC,UAAU,GAAGC,sBAAsB,CAACF,OAAO,CAAC,YAAD,CAAR,CAAvC;;AAEA,IAAIG,iBAAiB,GAAGJ,uBAAuB,CAACC,OAAO,CAAC,mBAAD,CAAR,CAA/C;;AAEA,IAAII,OAAO,GAAGJ,OAAO,CAAC,SAAD,CAArB;;AAEA,IAAIK,gBAAgB,GAAGH,sBAAsB,CAACF,OAAO,CAAC,6BAAD,CAAR,CAA7C;;AAEA,IAAIM,UAAU,GAAGJ,sBAAsB,CAACF,OAAO,CAAC,uBAAD,CAAR,CAAvC;;AAEA,IAAIO,iBAAiB,GAAGL,sBAAsB,CAACF,OAAO,CAAC,8BAAD,CAAR,CAA9C;;AAEA,IAAIQ,YAAY,GAAGN,sBAAsB,CAACF,OAAO,CAAC,yBAAD,CAAR,CAAzC;;AAEA,IAAIS,iBAAiB,GAAGP,sBAAsB,CAACF,OAAO,CAAC,+BAAD,CAAR,CAA9C;;AAEA,IAAIU,cAAc,GAAGR,sBAAsB,CAACF,OAAO,CAAC,2BAAD,CAAR,CAA3C;;AAEA,IAAIW,aAAa,GAAGZ,uBAAuB,CAACC,OAAO,CAAC,kBAAD,CAAR,CAA3C;;AAEA,IAAIY,aAAa,GAAGZ,OAAO,CAAC,iBAAD,CAA3B;;AAEA,SAASE,sBAAT,CAAgCW,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAE,eAAWA;AAAb,GAArC;AAA0D;;AAEjG,SAASE,wBAAT,GAAoC;AAAE,MAAI,OAAOC,OAAP,KAAmB,UAAvB,EAAmC,OAAO,IAAP;AAAa,MAAIC,KAAK,GAAG,IAAID,OAAJ,EAAZ;;AAA2BD,EAAAA,wBAAwB,GAAG,SAASA,wBAAT,GAAoC;AAAE,WAAOE,KAAP;AAAe,GAAhF;;AAAkF,SAAOA,KAAP;AAAe;;AAElN,SAASlB,uBAAT,CAAiCc,GAAjC,EAAsC;AAAE,MAAIA,GAAG,IAAIA,GAAG,CAACC,UAAf,EAA2B;AAAE,WAAOD,GAAP;AAAa;;AAAC,MAAIA,GAAG,KAAK,IAAR,IAAgBK,OAAO,CAACL,GAAD,CAAP,KAAiB,QAAjB,IAA6B,OAAOA,GAAP,KAAe,UAAhE,EAA4E;AAAE,WAAO;AAAE,iBAAWA;AAAb,KAAP;AAA4B;;AAAC,MAAII,KAAK,GAAGF,wBAAwB,EAApC;;AAAwC,MAAIE,KAAK,IAAIA,KAAK,CAACE,GAAN,CAAUN,GAAV,CAAb,EAA6B;AAAE,WAAOI,KAAK,CAACG,GAAN,CAAUP,GAAV,CAAP;AAAwB;;AAAC,MAAIQ,MAAM,GAAG,EAAb;AAAiB,MAAIC,qBAAqB,GAAG5B,MAAM,CAACC,cAAP,IAAyBD,MAAM,CAAC6B,wBAA5D;;AAAsF,OAAK,IAAIC,GAAT,IAAgBX,GAAhB,EAAqB;AAAE,QAAInB,MAAM,CAAC+B,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCd,GAArC,EAA0CW,GAA1C,CAAJ,EAAoD;AAAE,UAAII,IAAI,GAAGN,qBAAqB,GAAG5B,MAAM,CAAC6B,wBAAP,CAAgCV,GAAhC,EAAqCW,GAArC,CAAH,GAA+C,IAA/E;;AAAqF,UAAII,IAAI,KAAKA,IAAI,CAACR,GAAL,IAAYQ,IAAI,CAACC,GAAtB,CAAR,EAAoC;AAAEnC,QAAAA,MAAM,CAACC,cAAP,CAAsB0B,MAAtB,EAA8BG,GAA9B,EAAmCI,IAAnC;AAA2C,OAAjF,MAAuF;AAAEP,QAAAA,MAAM,CAACG,GAAD,CAAN,GAAcX,GAAG,CAACW,GAAD,CAAjB;AAAyB;AAAE;AAAE;;AAACH,EAAAA,MAAM,CAAC,SAAD,CAAN,GAAoBR,GAApB;;AAAyB,MAAII,KAAJ,EAAW;AAAEA,IAAAA,KAAK,CAACY,GAAN,CAAUhB,GAAV,EAAeQ,MAAf;AAAyB;;AAAC,SAAOA,MAAP;AAAgB;;AAE9uB,SAASH,OAAT,CAAiBL,GAAjB,EAAsB;AAAE;;AAA2B,MAAI,OAAOiB,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA/D,EAAyE;AAAEb,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBL,GAAjB,EAAsB;AAAE,aAAO,OAAOA,GAAd;AAAoB,KAAtD;AAAyD,GAApI,MAA0I;AAAEK,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBL,GAAjB,EAAsB;AAAE,aAAOA,GAAG,IAAI,OAAOiB,MAAP,KAAkB,UAAzB,IAAuCjB,GAAG,CAACmB,WAAJ,KAAoBF,MAA3D,IAAqEjB,GAAG,KAAKiB,MAAM,CAACL,SAApF,GAAgG,QAAhG,GAA2G,OAAOZ,GAAzH;AAA+H,KAAjK;AAAoK;;AAAC,SAAOK,OAAO,CAACL,GAAD,CAAd;AAAsB;;AAE1X,SAASoB,OAAT,CAAiBC,MAAjB,EAAyBC,cAAzB,EAAyC;AAAE,MAAIC,IAAI,GAAG1C,MAAM,CAAC0C,IAAP,CAAYF,MAAZ,CAAX;;AAAgC,MAAIxC,MAAM,CAAC2C,qBAAX,EAAkC;AAAE,QAAIC,OAAO,GAAG5C,MAAM,CAAC2C,qBAAP,CAA6BH,MAA7B,CAAd;AAAoD,QAAIC,cAAJ,EAAoBG,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe,UAAUC,GAAV,EAAe;AAAE,aAAO9C,MAAM,CAAC6B,wBAAP,CAAgCW,MAAhC,EAAwCM,GAAxC,EAA6CC,UAApD;AAAiE,KAAjG,CAAV;AAA8GL,IAAAA,IAAI,CAACM,IAAL,CAAUC,KAAV,CAAgBP,IAAhB,EAAsBE,OAAtB;AAAiC;;AAAC,SAAOF,IAAP;AAAc;;AAErV,SAASQ,aAAT,CAAuBC,MAAvB,EAA+B;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAT,IAAgB,IAAhB,GAAuBC,SAAS,CAACD,CAAD,CAAhC,GAAsC,EAAnD;;AAAuD,QAAIA,CAAC,GAAG,CAAR,EAAW;AAAEb,MAAAA,OAAO,CAACvC,MAAM,CAACuD,MAAD,CAAP,EAAiB,IAAjB,CAAP,CAA8BC,OAA9B,CAAsC,UAAU1B,GAAV,EAAe;AAAE2B,QAAAA,eAAe,CAACN,MAAD,EAASrB,GAAT,EAAcyB,MAAM,CAACzB,GAAD,CAApB,CAAf;AAA4C,OAAnG;AAAuG,KAApH,MAA0H,IAAI9B,MAAM,CAAC0D,yBAAX,EAAsC;AAAE1D,MAAAA,MAAM,CAAC2D,gBAAP,CAAwBR,MAAxB,EAAgCnD,MAAM,CAAC0D,yBAAP,CAAiCH,MAAjC,CAAhC;AAA4E,KAApH,MAA0H;AAAEhB,MAAAA,OAAO,CAACvC,MAAM,CAACuD,MAAD,CAAP,CAAP,CAAwBC,OAAxB,CAAgC,UAAU1B,GAAV,EAAe;AAAE9B,QAAAA,MAAM,CAACC,cAAP,CAAsBkD,MAAtB,EAA8BrB,GAA9B,EAAmC9B,MAAM,CAAC6B,wBAAP,CAAgC0B,MAAhC,EAAwCzB,GAAxC,CAAnC;AAAmF,OAApI;AAAwI;AAAE;;AAAC,SAAOqB,MAAP;AAAgB;;AAEthB,SAASS,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,iBAAT,CAA2Bb,MAA3B,EAAmCc,KAAnC,EAA0C;AAAE,OAAK,IAAIb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGa,KAAK,CAACX,MAA1B,EAAkCF,CAAC,EAAnC,EAAuC;AAAE,QAAIc,UAAU,GAAGD,KAAK,CAACb,CAAD,CAAtB;AAA2Bc,IAAAA,UAAU,CAACnB,UAAX,GAAwBmB,UAAU,CAACnB,UAAX,IAAyB,KAAjD;AAAwDmB,IAAAA,UAAU,CAACC,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWD,UAAf,EAA2BA,UAAU,CAACE,QAAX,GAAsB,IAAtB;AAA4BpE,IAAAA,MAAM,CAACC,cAAP,CAAsBkD,MAAtB,EAA8Be,UAAU,CAACpC,GAAzC,EAA8CoC,UAA9C;AAA4D;AAAE;;AAE7T,SAASG,YAAT,CAAsBP,WAAtB,EAAmCQ,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBN,iBAAiB,CAACF,WAAW,CAAC/B,SAAb,EAAwBuC,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBP,iBAAiB,CAACF,WAAD,EAAcS,WAAd,CAAjB;AAA6C,SAAOT,WAAP;AAAqB;;AAEvN,SAASU,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AAAE,UAAM,IAAIX,SAAJ,CAAc,oDAAd,CAAN;AAA4E;;AAACU,EAAAA,QAAQ,CAAC1C,SAAT,GAAqB/B,MAAM,CAAC2E,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAAC3C,SAAvC,EAAkD;AAAEO,IAAAA,WAAW,EAAE;AAAEnC,MAAAA,KAAK,EAAEsE,QAAT;AAAmBL,MAAAA,QAAQ,EAAE,IAA7B;AAAmCD,MAAAA,YAAY,EAAE;AAAjD;AAAf,GAAlD,CAArB;AAAkJ,MAAIO,UAAJ,EAAgBE,eAAe,CAACH,QAAD,EAAWC,UAAX,CAAf;AAAwC;;AAEjY,SAASE,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;AAAEF,EAAAA,eAAe,GAAG5E,MAAM,CAAC+E,cAAP,IAAyB,SAASH,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;AAAED,IAAAA,CAAC,CAACG,SAAF,GAAcF,CAAd;AAAiB,WAAOD,CAAP;AAAW,GAAxG;;AAA0G,SAAOD,eAAe,CAACC,CAAD,EAAIC,CAAJ,CAAtB;AAA+B;;AAE1K,SAASG,YAAT,CAAsBC,OAAtB,EAA+B;AAAE,MAAIC,yBAAyB,GAAGC,yBAAyB,EAAzD;;AAA6D,SAAO,SAASC,oBAAT,GAAgC;AAAE,QAAIC,KAAK,GAAGC,eAAe,CAACL,OAAD,CAA3B;AAAA,QAAsCM,MAAtC;;AAA8C,QAAIL,yBAAJ,EAA+B;AAAE,UAAIM,SAAS,GAAGF,eAAe,CAAC,IAAD,CAAf,CAAsBjD,WAAtC;;AAAmDkD,MAAAA,MAAM,GAAGE,OAAO,CAACC,SAAR,CAAkBL,KAAlB,EAAyBjC,SAAzB,EAAoCoC,SAApC,CAAT;AAA0D,KAA9I,MAAoJ;AAAED,MAAAA,MAAM,GAAGF,KAAK,CAACrC,KAAN,CAAY,IAAZ,EAAkBI,SAAlB,CAAT;AAAwC;;AAAC,WAAOuC,0BAA0B,CAAC,IAAD,EAAOJ,MAAP,CAAjC;AAAkD,GAAxU;AAA2U;;AAEza,SAASI,0BAAT,CAAoCC,IAApC,EAA0C5D,IAA1C,EAAgD;AAAE,MAAIA,IAAI,KAAKT,OAAO,CAACS,IAAD,CAAP,KAAkB,QAAlB,IAA8B,OAAOA,IAAP,KAAgB,UAAnD,CAAR,EAAwE;AAAE,WAAOA,IAAP;AAAc;;AAAC,SAAO6D,sBAAsB,CAACD,IAAD,CAA7B;AAAsC;;AAEjL,SAASC,sBAAT,CAAgCD,IAAhC,EAAsC;AAAE,MAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;AAAE,UAAM,IAAIE,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF;;AAAC,SAAOF,IAAP;AAAc;;AAEtK,SAAST,yBAAT,GAAqC;AAAE,MAAI,OAAOM,OAAP,KAAmB,WAAnB,IAAkC,CAACA,OAAO,CAACC,SAA/C,EAA0D,OAAO,KAAP;AAAc,MAAID,OAAO,CAACC,SAAR,CAAkBK,IAAtB,EAA4B,OAAO,KAAP;AAAc,MAAI,OAAOC,KAAP,KAAiB,UAArB,EAAiC,OAAO,IAAP;;AAAa,MAAI;AAAEC,IAAAA,IAAI,CAACnE,SAAL,CAAeoE,QAAf,CAAwBlE,IAAxB,CAA6ByD,OAAO,CAACC,SAAR,CAAkBO,IAAlB,EAAwB,EAAxB,EAA4B,YAAY,CAAE,CAA1C,CAA7B;AAA2E,WAAO,IAAP;AAAc,GAA/F,CAAgG,OAAOE,CAAP,EAAU;AAAE,WAAO,KAAP;AAAe;AAAE;;AAEpU,SAASb,eAAT,CAAyBV,CAAzB,EAA4B;AAAEU,EAAAA,eAAe,GAAGvF,MAAM,CAAC+E,cAAP,GAAwB/E,MAAM,CAACqG,cAA/B,GAAgD,SAASd,eAAT,CAAyBV,CAAzB,EAA4B;AAAE,WAAOA,CAAC,CAACG,SAAF,IAAehF,MAAM,CAACqG,cAAP,CAAsBxB,CAAtB,CAAtB;AAAiD,GAAjJ;AAAmJ,SAAOU,eAAe,CAACV,CAAD,CAAtB;AAA4B;;AAE7M,SAASpB,eAAT,CAAyBtC,GAAzB,EAA8BW,GAA9B,EAAmC3B,KAAnC,EAA0C;AAAE,MAAI2B,GAAG,IAAIX,GAAX,EAAgB;AAAEnB,IAAAA,MAAM,CAACC,cAAP,CAAsBkB,GAAtB,EAA2BW,GAA3B,EAAgC;AAAE3B,MAAAA,KAAK,EAAEA,KAAT;AAAgB4C,MAAAA,UAAU,EAAE,IAA5B;AAAkCoB,MAAAA,YAAY,EAAE,IAAhD;AAAsDC,MAAAA,QAAQ,EAAE;AAAhE,KAAhC;AAA0G,GAA5H,MAAkI;AAAEjD,IAAAA,GAAG,CAACW,GAAD,CAAH,GAAW3B,KAAX;AAAmB;;AAAC,SAAOgB,GAAP;AAAa;;AAEjN,IAAImF,UAAU,GAAG,CAAC,8BAAD,EAAiC,wBAAjC,EAA2D,uBAA3D,EAAoF,YAApF,EAAkG,WAAlG,CAAjB;AACA,IAAIC,WAAW,GAAG;AAChBC,EAAAA,KAAK,EAAE,IADS;AAEhBC,EAAAA,KAAK,EAAE;AAFS,CAAlB;;AAKA,IAAIC,OAAO,GAAGjG,iBAAiB,CAAC,SAAD,CAAjB,CAA6BkG,GAA7B,CAAiCC,UAAjC,CAA4C;AACxDC,EAAAA,WAAW,EAAE,yBAD2C;AAExDC,EAAAA,WAAW,EAAE;AAF2C,CAA5C,EAGX,CAAC,uOAAD,CAHW,CAAd;;AAKA,IAAIC,UAAU,GAAGtG,iBAAiB,CAAC,SAAD,CAAjB,CAA6BkG,GAA7B,CAAiCC,UAAjC,CAA4C;AAC3DC,EAAAA,WAAW,EAAE,4BAD8C;AAE3DC,EAAAA,WAAW,EAAE;AAF8C,CAA5C,EAGd,CAAC,yBAAD,CAHc,CAAjB;;AAKA,IAAIE,KAAK,GAAGvG,iBAAiB,CAAC,SAAD,CAAjB,CAA6BgG,KAA7B,CAAmCG,UAAnC,CAA8C;AACxDC,EAAAA,WAAW,EAAE,uBAD2C;AAExDC,EAAAA,WAAW,EAAE;AAF2C,CAA9C,EAGT,CAAC,2IAAD,EAA8I,GAA9I,EAAmJ,GAAnJ,CAHS,EAGgJ,UAAU7C,KAAV,EAAiB;AAC3K,SAAOA,KAAK,CAACgD,SAAN,IAAmB,CAAC,GAAGxG,iBAAiB,CAACyG,GAAtB,EAA2B,CAAC,4CAAD,CAA3B,CAA1B;AACD,CALW,EAKT,UAAUjD,KAAV,EAAiB;AAClB,SAAOA,KAAK,CAACkD,OAAN,IAAiB,CAAC,GAAG1G,iBAAiB,CAACyG,GAAtB,EAA2B,CAAC,iBAAD,CAA3B,CAAxB;AACD,CAPW,CAAZ;;AASA,IAAIE,aAAa,GAAG,aAAa,UAAUC,UAAV,EAAsB;AACrD7C,EAAAA,SAAS,CAAC4C,aAAD,EAAgBC,UAAhB,CAAT;;AAEA,MAAIC,MAAM,GAAGrC,YAAY,CAACmC,aAAD,CAAzB;;AAEA,WAASA,aAAT,GAAyB;AACvB,QAAIG,KAAJ;;AAEA3D,IAAAA,eAAe,CAAC,IAAD,EAAOwD,aAAP,CAAf;;AAEA,SAAK,IAAII,IAAI,GAAGnE,SAAS,CAACC,MAArB,EAA6BmE,IAAI,GAAG,IAAIC,KAAJ,CAAUF,IAAV,CAApC,EAAqDG,IAAI,GAAG,CAAjE,EAAoEA,IAAI,GAAGH,IAA3E,EAAiFG,IAAI,EAArF,EAAyF;AACvFF,MAAAA,IAAI,CAACE,IAAD,CAAJ,GAAatE,SAAS,CAACsE,IAAD,CAAtB;AACD;;AAEDJ,IAAAA,KAAK,GAAGD,MAAM,CAACrF,IAAP,CAAYgB,KAAZ,CAAkBqE,MAAlB,EAA0B,CAAC,IAAD,EAAOM,MAAP,CAAcH,IAAd,CAA1B,CAAR;;AAEAhE,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,YAAhC,EAA8C,aAAanH,MAAM,CAAC,SAAD,CAAN,CAAkByH,SAAlB,EAA3D,CAAf;;AAEApE,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,sBAAhC,EAAwD,KAAxD,CAAf;;AAEA9D,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,qBAAhC,EAAuD,CAAvD,CAAf;;AAEA9D,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,OAAhC,EAAyC;AACtDO,MAAAA,WAAW,EAAE,KADyC;AAEtDC,MAAAA,UAAU,EAAE,KAF0C;AAGtDC,MAAAA,YAAY,EAAE,KAHwC;AAItDC,MAAAA,gBAAgB,EAAE,KAJoC;AAKtDC,MAAAA,kBAAkB,EAAE,IALkC;AAMtDC,MAAAA,eAAe,EAAE,KANqC;AAOtDC,MAAAA,KAAK,EAAE,IAP+C;AAQtDC,MAAAA,aAAa,EAAE,KARuC;AAStDC,MAAAA,0BAA0B,EAAE,IAT0B;AAUtDC,MAAAA,qBAAqB,EAAE,IAV+B;AAWtDC,MAAAA,MAAM,EAAEC,SAX8C;AAYtDC,MAAAA,eAAe,EAAE,IAZqC;AAatDC,MAAAA,kBAAkB,EAAE;AAbkC,KAAzC,CAAf;;AAgBAlF,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,cAAhC,EAAgD,YAAY;AACzE,UAAIqB,QAAQ,GAAGvF,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBoF,SAAzC,GAAqDpF,SAAS,CAAC,CAAD,CAA9D,GAAoE,IAAnF;;AAEA,UAAIkE,KAAK,CAACtD,KAAN,CAAY4E,cAAhB,EAAgC;AAC9BtB,QAAAA,KAAK,CAACtD,KAAN,CAAY4E,cAAZ;AACD;;AAEDC,MAAAA,SAAS,CAACC,YAAV,CAAuBC,gBAAvB,GAA0CC,IAA1C,CAA+C,UAAUF,YAAV,EAAwB;AACrE,YAAIG,YAAY,GAAGH,YAAY,CAAClG,MAAb,CAAoB,UAAUsG,CAAV,EAAa;AAClD,iBAAOA,CAAC,CAACC,IAAF,KAAW,YAAlB;AACD,SAFkB,CAAnB;;AAIA,YAAIR,QAAQ,IAAIM,YAAY,CAAC,CAAD,CAAxB,IAA+BA,YAAY,CAACG,IAAb,CAAkB,UAAUF,CAAV,EAAa;AAChE,iBAAOA,CAAC,CAACP,QAAT;AACD,SAFkC,MAE5BH,SAFP,EAEkB;AAChB,iBAAOlB,KAAK,CAAC+B,WAAN,CAAkB,IAAIpI,aAAa,CAACqI,wCAAlB,EAAlB,CAAP;AACD;;AAED,YAAIb,eAAe,GAAG,OAAOE,QAAP,KAAoB,QAApB,GAA+BA,QAA/B,GAA0CM,YAAY,CAAC,CAAD,CAAZ,CAAgBN,QAAhF;;AAEArB,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACbxB,UAAAA,YAAY,EAAE,IADD;AAEbC,UAAAA,gBAAgB,EAAE,KAFL;AAGbE,UAAAA,eAAe,EAAE,KAHJ;AAIbO,UAAAA,eAAe,EAAEA,eAJJ;AAKbC,UAAAA,kBAAkB,EAAEO,YAAY,CAACO,GAAb,CAAiB,UAAUN,CAAV,EAAa;AAChD,mBAAOA,CAAC,CAACP,QAAT;AACD,WAFmB,CALP;AAQbR,UAAAA,KAAK,EAAE;AARM,SAAf;;AAWA,YAAIsB,kBAAkB,GAAG;AACvBlD,UAAAA,KAAK,EAAE,IADgB;AAEvBC,UAAAA,KAAK,EAAE;AAFgB,SAAzB;;AAKA,YAAIkD,kBAAkB,GAAGzG,aAAa,CAACA,aAAa,CAAC,EAAD,EAAKqE,KAAK,CAACtD,KAAN,CAAY2F,WAAjB,CAAd,EAA6C,EAA7C,EAAiD;AACrFnD,UAAAA,KAAK,EAAE;AACLmC,YAAAA,QAAQ,EAAE;AACRiB,cAAAA,KAAK,EAAEnB;AADC;AADL;AAD8E,SAAjD,CAAtC;;AAQAI,QAAAA,SAAS,CAACC,YAAV,CAAuBe,YAAvB,CAAoCH,kBAApC,EAAwD,OAAxD,EAAiE,UAAUI,GAAV,EAAe;AAC9E;AACA,cAAIA,GAAG,CAACC,IAAJ,KAAa,kBAAb,IAAmCD,GAAG,CAACC,IAAJ,KAAa,sBAApD,EAA4E;AAC1EC,YAAAA,OAAO,CAACC,IAAR,CAAa,OAAOtC,MAAP,CAAcmC,GAAG,CAACC,IAAlB,EAAwB,uDAAxB,CAAb;AACA,mBAAOlB,SAAS,CAACC,YAAV,CAAuBe,YAAvB,CAAoCJ,kBAApC,CAAP;AACD;;AAED,gBAAMK,GAAN;AACD,SARD,EAQGd,IARH,CAQQ1B,KAAK,CAAC4C,aARd,EAQ6B,OAR7B,EAQsC5C,KAAK,CAAC+B,WAR5C;AASD,OA9CD,EA8CG,OA9CH,EA8CY/B,KAAK,CAAC+B,WA9ClB;AA+CD,KAtDc,CAAf;;AAwDA7F,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,oBAAhC,EAAsD,YAAY;AAC/E,UAAIA,KAAK,CAACtD,KAAN,CAAYmG,cAAhB,EAAgC;AAC9B7C,QAAAA,KAAK,CAACtD,KAAN,CAAYmG,cAAZ;AACD;;AAED,UAAIC,WAAW,GAAG9C,KAAK,CAAC+C,KAAxB;AAAA,UACI5B,eAAe,GAAG2B,WAAW,CAAC3B,eADlC;AAAA,UAEIC,kBAAkB,GAAG0B,WAAW,CAAC1B,kBAFrC,CAL+E,CAOtB;;AAEzDpB,MAAAA,KAAK,CAACiB,MAAN,IAAgBjB,KAAK,CAACiB,MAAN,CAAa+B,SAAb,GAAyB/G,OAAzB,CAAiC,UAAUgF,MAAV,EAAkB;AACjE,eAAOA,MAAM,CAACgC,IAAP,EAAP;AACD,OAFe,CAAhB;AAGA,UAAIC,KAAK,GAAG9B,kBAAkB,CAAC+B,SAAnB,CAA6B,UAAUvB,CAAV,EAAa;AACpD,eAAOA,CAAC,KAAKT,eAAb;AACD,OAFW,CAAZ;AAGA,UAAIiC,QAAQ,GAAGhC,kBAAkB,CAACrF,MAAnB,GAA4B,CAA3C;;AAEA,UAAImH,KAAK,GAAG,CAAZ,EAAe;AACb,eAAOlD,KAAK,CAAC+B,WAAN,CAAkB,IAAIpI,aAAa,CAACqI,wCAAlB,EAAlB,CAAP;AACD;;AAED,UAAIkB,KAAK,GAAG,CAAR,GAAYE,QAAhB,EAA0B,OAAOpD,KAAK,CAACqD,YAAN,CAAmBjC,kBAAkB,CAAC,CAAD,CAArC,CAAP;AAC1B,aAAOpB,KAAK,CAACqD,YAAN,CAAmBjC,kBAAkB,CAAC8B,KAAK,GAAG,CAAT,CAArC,CAAP;AACD,KAvBc,CAAf;;AAyBAhH,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,eAAhC,EAAiD,YAAY;AAC1E,UAAIA,KAAK,CAACtD,KAAN,CAAY4G,eAAhB,EAAiC;AAC/BtD,QAAAA,KAAK,CAACtD,KAAN,CAAY4G,eAAZ;AACD;;AAEDtD,MAAAA,KAAK,CAACiB,MAAN,IAAgBjB,KAAK,CAACiB,MAAN,CAAa+B,SAAb,GAAyB/G,OAAzB,CAAiC,UAAUgF,MAAV,EAAkB;AACjE,eAAOA,MAAM,CAACgC,IAAP,EAAP;AACD,OAFe,CAAhB;;AAIAjD,MAAAA,KAAK,CAACiC,QAAN,CAAe;AACbzB,QAAAA,UAAU,EAAE;AADC,OAAf;;AAIA+C,MAAAA,aAAa,CAACvD,KAAK,CAACwD,eAAP,CAAb;AACD,KAdc,CAAf;;AAgBAtH,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,eAAhC,EAAiD,UAAUiB,MAAV,EAAkB;AAChF;AACA;AACA,UAAIjB,KAAK,CAACyD,oBAAV,EAAgC;AAC9B;AACD;;AAEDzD,MAAAA,KAAK,CAACiB,MAAN,GAAeA,MAAf;;AAEAjB,MAAAA,KAAK,CAACiC,QAAN,CAAe;AACbzB,QAAAA,UAAU,EAAE,IADC;AAEbS,QAAAA,MAAM,EAAEA;AAFK,OAAf;;AAKA,UAAIjB,KAAK,CAACtD,KAAN,CAAYgH,UAAhB,EAA4B;AAC1B1D,QAAAA,KAAK,CAACtD,KAAN,CAAYgH,UAAZ;AACD;;AAED,UAAIC,MAAM,CAACC,GAAX,EAAgB;AACd5D,QAAAA,KAAK,CAAC6D,WAAN,CAAkBC,SAAlB,GAA8B7C,MAA9B;AACD,OAFD,MAEO;AACLjB,QAAAA,KAAK,CAAC6D,WAAN,CAAkBE,GAAlB,GAAwB9C,MAAxB;AACD,OAtB+E,CAsB9E;AACF;AACA;;;AAGA+C,MAAAA,UAAU,CAAC,YAAY;AACrBhE,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACbxB,UAAAA,YAAY,EAAE,KADD;AAEbK,UAAAA,aAAa,EAAE;AAFF,SAAf;AAID,OALS,EAKP,GALO,CAAV;AAMD,KAjCc,CAAf;;AAmCA5E,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,aAAhC,EAA+C,UAAUwC,GAAV,EAAe;AAC3E,UAAIyB,OAAO,GAAGjE,KAAK,CAACtD,KAAN,CAAYuH,OAA1B;;AAEA,UAAIA,OAAJ,EAAa;AACXA,QAAAA,OAAO,CAACzB,GAAD,CAAP;AACD;;AAED,UAAIxC,KAAK,CAACyD,oBAAV,EAAgC;AAC9B;AACD;;AAEDf,MAAAA,OAAO,CAAC7B,KAAR,CAAc,gBAAd,EAAgC2B,GAAhC;AACA0B,MAAAA,YAAY,CAAClE,KAAK,CAACmE,gBAAP,CAAZ;;AAEAnE,MAAAA,KAAK,CAACiC,QAAN,CAAe;AACbxB,QAAAA,YAAY,EAAET,KAAK,CAAC+C,KAAN,CAAYtC,YAAZ,IAA4B,KAD7B;AAEbF,QAAAA,WAAW,EAAE,KAFA;AAGbK,QAAAA,eAAe,EAAE,IAHJ;AAIbC,QAAAA,KAAK,EAAE2B;AAJM,OAAf;;AAOA,UAAIxC,KAAK,CAAC+C,KAAN,CAAYvC,UAAhB,EAA4B;AAC1BR,QAAAA,KAAK,CAACoE,aAAN;AACD;AACF,KAxBc,CAAf;;AA0BAlI,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,iBAAhC,EAAmD,UAAUqE,KAAV,EAAiB;AACjF,UAAIxD,KAAK,GAAG,IAAIlH,aAAa,CAAC2K,gCAAlB,CAAmDD,KAAnD,CAAZ;AACA3B,MAAAA,OAAO,CAAC7B,KAAR,CAAcA,KAAK,CAAC0D,OAApB,EAA6BF,KAA7B;;AAEArE,MAAAA,KAAK,CAAC+B,WAAN,CAAkBlB,KAAlB;;AAEA,aAAO,KAAP;AACD,KAPc,CAAf;;AASA3E,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,aAAhC,EAA+C,YAAY;AACxE,UAAIA,KAAK,CAACtD,KAAN,CAAY8H,QAAhB,EAA0B;AACxB,eAAOxE,KAAK,CAACtD,KAAN,CAAY8H,QAAnB;AACD;;AAED,UAAIA,QAAQ,GAAGb,MAAM,CAACc,aAAP,CAAqBC,eAArB,GAAuC3F,UAAU,CAAC+C,IAAX,CAAgB6B,MAAM,CAACc,aAAP,CAAqBC,eAArC,CAAvC,GAA+F,YAA9G;AACA,aAAO1E,KAAK,CAAC2E,aAAN,IAAuB3E,KAAK,CAAC2E,aAAN,CAAoBH,QAA3C,IAAuDA,QAAvD,IAAmE,EAA1E;AACD,KAPc,CAAf;;AASAtI,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,gBAAhC,EAAkD,UAAUqE,KAAV,EAAiB;AAChF,UAAI,CAACA,KAAK,CAACO,IAAX,EAAiB,OAAO5E,KAAK,CAAC6E,eAAN,CAAsBR,KAAtB,CAAP;AACjB,UAAIS,SAAS,GAAG9E,KAAK,CAACtD,KAAN,CAAYoI,SAA5B;AACA,UAAIC,iBAAiB,GAAG,OAAOD,SAA/B,CAHgF,CAGtC;AAC1C;;AAEA,UAAIE,SAAS,GAAGhF,KAAK,CAACiF,aAAN,CAAoBlJ,MAApC;;AAEA,UAAIiJ,SAAS,GAAGD,iBAAZ,IAAiCC,SAAS,GAAGD,iBAAZ,KAAkC,CAAvE,EAA0E;AACxE,YAAIG,IAAI,GAAG,IAAIvB,MAAM,CAACwB,IAAX,CAAgBnF,KAAK,CAACiF,aAAtB,EAAqC;AAC9CG,UAAAA,IAAI,EAAEpF,KAAK,CAACqF,WAAN;AADwC,SAArC,CAAX;AAGA,YAAIH,IAAI,CAACI,IAAL,IAAa,CAAjB,EAAoB,OAAOtF,KAAK,CAAC6E,eAAN,CAAsBR,KAAtB,CAAP;AACrB;;AAED,aAAO,IAAP;AACD,KAhBc,CAAf;;AAkBAnI,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,wBAAhC,EAA0D,YAAY;AACnF,UAAId,KAAK,GAAGc,KAAK,CAACuF,WAAlB;AACArG,MAAAA,KAAK,CAACsG,KAAN,GAAc,KAAd;AACA,UAAIC,WAAW,GAAGvG,KAAK,CAACwG,IAAN,EAAlB;;AAEA,UAAI,CAACD,WAAL,EAAkB;AAChBvG,QAAAA,KAAK,CAACsG,KAAN,GAAc,IAAd;AACA;AACD;;AAEDC,MAAAA,WAAW,CAAC/D,IAAZ,CAAiB,YAAY;AAC3B1B,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACbtB,UAAAA,kBAAkB,EAAE;AADP,SAAf,EAD2B,CAGvB;;;AAGJ,YAAIX,KAAK,CAACtD,KAAN,CAAYiJ,6BAAhB,EAA+C;AAC7CzG,UAAAA,KAAK,CAAC0G,KAAN;AACA1G,UAAAA,KAAK,CAAC2G,IAAN,GAAa,KAAb;AACD;AACF,OAVD,EAUG,OAVH,EAUY,UAAUrD,GAAV,EAAe;AACzBE,QAAAA,OAAO,CAACC,IAAR,CAAa,iCAAb,EAAgDH,GAAhD;AACAtD,QAAAA,KAAK,CAACsG,KAAN,GAAc,IAAd;AACA,eAAOtG,KAAK,CAACwG,IAAN,EAAP;AACD,OAdD,EAcG,OAdH,EAcY,UAAUlD,GAAV,EAAe;AACzBE,QAAAA,OAAO,CAACC,IAAR,CAAa,qDAAb,EAAoEH,GAApE;AACD,OAhBD;AAiBD,KA3Bc,CAAf;;AA6BAtG,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,qBAAhC,EAAuD,UAAUqE,KAAV,EAAiB;AACrF,UAAIrE,KAAK,CAAC8F,cAAN,CAAqBzB,KAArB,CAAJ,EAAiC;AAC/BrE,QAAAA,KAAK,CAACiF,aAAN,CAAoBxJ,IAApB,CAAyB4I,KAAK,CAACO,IAA/B;AACD;AACF,KAJc,CAAf;;AAMA1I,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,qBAAhC,EAAuD,YAAY;AAChF,UAAIA,KAAK,CAACtD,KAAN,CAAYqJ,eAAhB,EAAiC;AAC/B/F,QAAAA,KAAK,CAACtD,KAAN,CAAYqJ,eAAZ;AACD;;AAED,UAAI,CAAC/F,KAAK,CAAC2E,aAAX,EAA0B;AACxB3E,QAAAA,KAAK,CAAC+B,WAAN,CAAkB,IAAIpI,aAAa,CAACqM,+CAAlB,EAAlB;;AAEA;AACD;;AAEDhG,MAAAA,KAAK,CAAC2E,aAAN,CAAoB1B,IAApB;AACD,KAZc,CAAf;;AAcA/G,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,sBAAhC,EAAwD,YAAY;AACjF,UAAIA,KAAK,CAACtD,KAAN,CAAYuJ,gBAAhB,EAAkC;AAChCjG,QAAAA,KAAK,CAACtD,KAAN,CAAYuJ,gBAAZ;AACD;;AAED,UAAI,CAACjG,KAAK,CAAC2E,aAAX,EAA0B;AACxB3E,QAAAA,KAAK,CAAC+B,WAAN,CAAkB,IAAIpI,aAAa,CAACqM,+CAAlB,EAAlB;;AAEA;AACD;;AAEDhG,MAAAA,KAAK,CAAC2E,aAAN,CAAoBiB,KAApB;AACD,KAZc,CAAf;;AAcA1J,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,uBAAhC,EAAyD,YAAY;AAClF,UAAIA,KAAK,CAACtD,KAAN,CAAYwJ,iBAAhB,EAAmC;AACjClG,QAAAA,KAAK,CAACtD,KAAN,CAAYwJ,iBAAZ;AACD;;AAED,UAAI,CAAClG,KAAK,CAAC2E,aAAX,EAA0B;AACxB3E,QAAAA,KAAK,CAAC+B,WAAN,CAAkB,IAAIpI,aAAa,CAACqM,+CAAlB,EAAlB;;AAEA;AACD;;AAEDhG,MAAAA,KAAK,CAAC2E,aAAN,CAAoBwB,MAApB;AACD,KAZc,CAAf;;AAcAjK,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,sBAAhC,EAAwD,YAAY;AACjF,UAAIA,KAAK,CAACtD,KAAN,CAAY0J,gBAAhB,EAAkC;AAChCpG,QAAAA,KAAK,CAACtD,KAAN,CAAY0J,gBAAZ;AACD;;AAEDpG,MAAAA,KAAK,CAACiC,QAAN,CAAe;AACboE,QAAAA,kBAAkB,EAAE,IADP;AAEb3F,QAAAA,gBAAgB,EAAE;AAFL,OAAf;;AAKAsD,MAAAA,UAAU,CAAC,YAAY;AACrB,eAAOhE,KAAK,CAACsG,cAAN,EAAP;AACD,OAFS,EAEPtG,KAAK,CAACtD,KAAN,CAAY6J,aAFL,CAAV;AAGD,KAbc,CAAf;;AAeArK,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,gBAAhC,EAAkD,YAAY;AAC3E,OAAC,GAAGtG,aAAa,CAAC8M,YAAlB,EAAgCxG,KAAK,CAAC6D,WAAtC,EAAmDnC,IAAnD,CAAwD,UAAU+E,SAAV,EAAqB;AAC3EzG,QAAAA,KAAK,CAACyG,SAAN,GAAkBA,SAAlB;AACAzG,QAAAA,KAAK,CAACiF,aAAN,GAAsB,EAAtB;AACA,YAAIyB,OAAO,GAAG;AACZlC,UAAAA,QAAQ,EAAExE,KAAK,CAACqF,WAAN;AADE,SAAd;;AAIA,YAAI;AACFrF,UAAAA,KAAK,CAACiC,QAAN,CAAe;AACboE,YAAAA,kBAAkB,EAAE,KADP;AAEb9F,YAAAA,WAAW,EAAE;AAFA,WAAf;;AAKAP,UAAAA,KAAK,CAAC2G,SAAN,GAAkB,IAAIhI,IAAJ,GAAWiI,OAAX,EAAlB;AACA5G,UAAAA,KAAK,CAAC2E,aAAN,GAAsB,IAAIhB,MAAM,CAACc,aAAX,CAAyBzE,KAAK,CAACiB,MAA/B,EAAuCyF,OAAvC,CAAtB;;AAEA1G,UAAAA,KAAK,CAAC2E,aAAN,CAAoBkC,gBAApB,CAAqC,MAArC,EAA6C7G,KAAK,CAAC8G,UAAnD;;AAEA9G,UAAAA,KAAK,CAAC2E,aAAN,CAAoBkC,gBAApB,CAAqC,OAArC,EAA8C7G,KAAK,CAAC+B,WAApD;;AAEA/B,UAAAA,KAAK,CAAC2E,aAAN,CAAoBkC,gBAApB,CAAqC,eAArC,EAAsD7G,KAAK,CAAC+G,mBAA5D;;AAEA,cAAIC,WAAW,GAAGhH,KAAK,CAACtD,KAAxB;AAAA,cACIuK,SAAS,GAAGD,WAAW,CAACC,SAD5B;AAAA,cAEInC,SAAS,GAAGkC,WAAW,CAAClC,SAF5B;AAAA,cAGIoC,oBAAoB,GAAGF,WAAW,CAACE,oBAHvC;;AAKAlH,UAAAA,KAAK,CAAC2E,aAAN,CAAoBwC,KAApB,CAA0BrC,SAA1B,EApBE,CAoBoC;;;AAGtC,cAAImC,SAAJ,EAAe;AACbjH,YAAAA,KAAK,CAACmE,gBAAN,GAAyBH,UAAU,CAAC,YAAY;AAC9ChE,cAAAA,KAAK,CAACoH,mBAAN;AACD,aAFkC,EAEhCH,SAFgC,CAAnC;AAGD,WA3BC,CA2BA;AACF;;;AAGA,cAAII,MAAM,CAACC,SAAP,CAAiBJ,oBAAjB,CAAJ,EAA4C;AAC1ClD,YAAAA,UAAU,CAAC,YAAY;AACrB,kBAAIhE,KAAK,CAACiF,aAAN,CAAoBlJ,MAApB,KAA+B,CAAnC,EAAsC;AACpCiE,gBAAAA,KAAK,CAAC+B,WAAN,CAAkB,IAAIpI,aAAa,CAAC4N,2CAAlB,CAA8DL,oBAA9D,CAAlB;AACD;AACF,aAJS,EAIPA,oBAJO,CAAV;AAKD;AACF,SAtCD,CAsCE,OAAO1E,GAAP,EAAY;AACZE,UAAAA,OAAO,CAAC7B,KAAR,CAAc,+BAAd,EAA+C2B,GAA/C,EAAoDkE,OAApD;;AAEA1G,UAAAA,KAAK,CAAC+B,WAAN,CAAkBS,GAAlB;AACD;AACF,OAlDD;AAmDD,KApDc,CAAf;;AAsDAtG,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,YAAhC,EAA8C,UAAUqE,KAAV,EAAiB;AAC5E,UAAImD,OAAO,GAAG,IAAI7I,IAAJ,GAAWiI,OAAX,EAAd;;AAEA,UAAI,CAAC5G,KAAK,CAACiF,aAAP,IAAwBjF,KAAK,CAACiF,aAAN,CAAoBlJ,MAApB,IAA8B,CAA1D,EAA6D;AAC3D,YAAI8E,KAAK,GAAG,IAAIlH,aAAa,CAAC8N,+CAAlB,CAAkEpD,KAAlE,CAAZ;AACA3B,QAAAA,OAAO,CAAC7B,KAAR,CAAcA,KAAK,CAAC0D,OAApB,EAA6BF,KAA7B;;AAEArE,QAAAA,KAAK,CAAC+B,WAAN,CAAkBlB,KAAlB;;AAEA;AACD;;AAEDqD,MAAAA,YAAY,CAAClE,KAAK,CAACmE,gBAAP,CAAZ;AACA,UAAIuD,SAAS,GAAG1H,KAAK,CAACiF,aAAN,CAAoBlJ,MAApB,KAA+B,CAA/B,GAAmCiE,KAAK,CAACiF,aAAN,CAAoB,CAApB,CAAnC,GAA4D,IAAItB,MAAM,CAACwB,IAAX,CAAgBnF,KAAK,CAACiF,aAAtB,EAAqC;AAC/GG,QAAAA,IAAI,EAAEpF,KAAK,CAACqF,WAAN;AADyG,OAArC,CAA5E;AAGA,UAAIsC,aAAa,GAAG3H,KAAK,CAACyG,SAA1B;AACA,UAAIE,SAAS,GAAG3G,KAAK,CAAC2G,SAAtB;AACA,UAAIiB,QAAQ,GAAGJ,OAAO,GAAGb,SAAzB,CAlB4E,CAkBxC;;AAEpC3G,MAAAA,KAAK,CAAC2E,aAAN,CAAoBkD,eAApB,GAAsC,IAAtC;;AAEA7H,MAAAA,KAAK,CAAC8H,gBAAN,CAAuBJ,SAAvB,EAAkChG,IAAlC,CAAuC,UAAUqG,cAAV,EAA0B;AAC/D/H,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACb1B,UAAAA,WAAW,EAAE,KADA;AAEbG,UAAAA,gBAAgB,EAAE,IAFL;AAGbC,UAAAA,kBAAkB,EAAE,IAHP;AAIboH,UAAAA,cAAc,EAAEA,cAJH;AAKbC,UAAAA,QAAQ,EAAErE,MAAM,CAACC,GAAP,CAAWqE,eAAX,CAA2BF,cAA3B;AALG,SAAf;;AAQA/H,QAAAA,KAAK,CAACoE,aAAN;;AAEApE,QAAAA,KAAK,CAACtD,KAAN,CAAYwL,mBAAZ,CAAgCH,cAAhC,EAAgDpB,SAAhD,EAA2DgB,aAA3D,EAA0EC,QAA1E;AACD,OAZD;AAaD,KAnCc,CAAf;;AAqCA1L,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,kBAAhC,EAAoD,UAAUmI,YAAV,EAAwB;AACzF,UAAIC,eAAJ,EAAqBC,qBAArB;;AAEA,UAAIC,QAAQ,GAAG,iCAAiCC,IAAjC,CAAsChH,SAAS,CAACiH,SAAhD,CAAf;;AAEA,UAAIF,QAAJ,EAAc;AACZ,eAAOG,OAAO,CAACC,OAAR,CAAgBP,YAAhB,CAAP;AACD,OAPwF,CAOvF;;;AAGF,OAACE,qBAAqB,GAAG,CAACD,eAAe,GAAGjD,IAAI,CAAC3K,SAAxB,EAAmCmO,WAA5D,MAA6E,IAA7E,IAAqFN,qBAAqB,KAAK,KAAK,CAApH,GAAwHA,qBAAxH,GAAgJD,eAAe,CAACO,WAAhB,GAA8B,YAAY;AACxL,eAAO,IAAIC,QAAJ,CAAa,IAAb,EAAmBD,WAAnB,EAAP;AACD,OAFD;AAGA,aAAOR,YAAY,CAACQ,WAAb,GAA2BjH,IAA3B,CAAgC,UAAUmH,MAAV,EAAkB;AACvD,YAAIC,SAAJ;;AAEA,YAAIC,OAAO,GAAG,IAAI5P,OAAO,CAAC6P,OAAZ,EAAd;AACA,YAAIC,QAAQ,GAAGF,OAAO,CAACG,MAAR,CAAeL,MAAf,CAAf,CAJuD,CAIhB;;AAEvC,YAAIM,YAAY,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,CAAnB;AACAF,QAAAA,QAAQ,GAAG,CAACH,SAAS,GAAGG,QAAb,MAA2B,IAA3B,IAAmCH,SAAS,KAAK,KAAK,CAAtD,GAA0D,KAAK,CAA/D,GAAmEA,SAAS,CAACxN,MAAV,CAAiB,UAAU8N,GAAV,EAAe;AAC5G,iBAAOD,YAAY,CAACE,QAAb,CAAsBD,GAAG,CAAChE,IAA1B,CAAP;AACD,SAF6E,CAA9E;AAGA,YAAIkE,MAAM,GAAG,IAAInQ,OAAO,CAACoQ,MAAZ,EAAb;AACAD,QAAAA,MAAM,CAACE,OAAP,GAAiB,KAAjB;AACAF,QAAAA,MAAM,CAACG,qBAAP,GAA+B,KAA/B;AACAR,QAAAA,QAAQ,CAAChN,OAAT,CAAiB,UAAUyN,OAAV,EAAmB;AAClC,iBAAOJ,MAAM,CAACK,IAAP,CAAYD,OAAZ,CAAP;AACD,SAFD;AAGAJ,QAAAA,MAAM,CAACrG,IAAP;;AAEA,YAAI2G,gBAAgB,GAAGzQ,OAAO,CAAC0Q,KAAR,CAAcC,oBAAd,CAAmCR,MAAM,CAACS,SAA1C,EAAqDT,MAAM,CAAC1B,QAA5D,EAAsE0B,MAAM,CAACU,IAA7E,CAAvB;;AAEA,YAAIC,QAAQ,GAAGpB,MAAM,CAACqB,KAAP,CAAaZ,MAAM,CAACa,YAApB,CAAf;AACA,YAAIlM,MAAM,GAAG,IAAIkH,IAAJ,CAAS,CAACyE,gBAAD,EAAmBK,QAAnB,CAAT,EAAuC;AAClD7E,UAAAA,IAAI,EAAE+C,YAAY,CAAC/C;AAD+B,SAAvC,CAAb;AAGA,eAAOnH,MAAP;AACD,OAzBM,CAAP;AA0BD,KAvCc,CAAf;;AAyCA/B,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,qBAAhC,EAAuD,UAAUnB,CAAV,EAAa;AACjF,UAAImB,KAAK,CAAC+C,KAAN,CAAYrC,gBAAhB,EAAkC;AAChCV,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACbvB,UAAAA,gBAAgB,EAAE;AADL,SAAf;AAGD;;AAED,UAAI0J,KAAK,GAAGvL,CAAC,CAACjD,MAAF,CAASwO,KAAT,IAAkBvL,CAAC,CAACwL,YAAF,CAAeD,KAA7C;AACA,UAAIA,KAAK,CAACrO,MAAN,KAAiB,CAArB,EAAwB;AACxB,UAAI4K,SAAS,GAAG,IAAIhI,IAAJ,GAAWiI,OAAX,EAAhB;AACA,UAAI1H,KAAK,GAAGkL,KAAK,CAAC,CAAD,CAAjB;AACAvL,MAAAA,CAAC,CAACjD,MAAF,CAAShD,KAAT,GAAiB,IAAjB;AACA,UAAI0R,SAAS,GAAGpL,KAAK,CAACkG,IAAN,KAAe,iBAAf,GAAmC,KAAnC,GAA2ClE,SAA3D;AACA,OAAC,GAAGxH,aAAa,CAAC,SAAD,CAAjB,EAA8BwF,KAA9B,EAAqCwC,IAArC,CAA0C,UAAU6I,IAAV,EAAgB;AACxD,YAAI3C,QAAQ,GAAG2C,IAAI,CAAC3C,QAApB;AAAA,YACInB,SAAS,GAAG8D,IAAI,CAAC9D,SADrB;;AAGAzG,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACb1B,UAAAA,WAAW,EAAE,KADA;AAEbG,UAAAA,gBAAgB,EAAE,IAFL;AAGbC,UAAAA,kBAAkB,EAAE,IAHP;AAIb+G,UAAAA,SAAS,EAAExI,KAJE;AAKb8I,UAAAA,QAAQ,EAAErE,MAAM,CAACC,GAAP,CAAWqE,eAAX,CAA2B/I,KAA3B;AALG,SAAf;;AAQAc,QAAAA,KAAK,CAACtD,KAAN,CAAYwL,mBAAZ,CAAgChJ,KAAhC,EAAuCyH,SAAvC,EAAkDF,SAAlD,EAA6DmB,QAA7D,EAAuE0C,SAAvE;AACD,OAbD,EAaG,OAbH,EAaY,UAAU9H,GAAV,EAAe;AACzBxC,QAAAA,KAAK,CAAC+B,WAAN,CAAkBS,GAAlB;AACD,OAfD;AAgBD,KA7Bc,CAAf;;AA+BAtG,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,sBAAhC,EAAwD,YAAY;AACjF,UAAIA,KAAK,CAACtD,KAAN,CAAY8N,gBAAhB,EAAkC;AAChCxK,QAAAA,KAAK,CAACtD,KAAN,CAAY8N,gBAAZ;AACD;;AAEDxK,MAAAA,KAAK,CAACyK,UAAN,CAAiBC,OAAjB,CAAyB9R,KAAzB,GAAiC,IAAjC;;AAEAoH,MAAAA,KAAK,CAACyK,UAAN,CAAiBC,OAAjB,CAAyBC,KAAzB,GAPiF,CAO/C;;;AAGlC3K,MAAAA,KAAK,CAACyK,UAAN,CAAiBC,OAAjB,CAAyB7D,gBAAzB,CAA0C,QAA1C,EAAoD7G,KAAK,CAAC4K,mBAA1D;AACD,KAXc,CAAf;;AAaA1O,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,qBAAhC,EAAuD,YAAY;AAChF,UAAIA,KAAK,CAACtD,KAAN,CAAYmO,eAAhB,EAAiC;AAC/B7K,QAAAA,KAAK,CAACtD,KAAN,CAAYmO,eAAZ;AACD;;AAED,UAAI7K,KAAK,CAACtD,KAAN,CAAYoO,aAAZ,IAA6B9K,KAAK,CAACtD,KAAN,CAAYqO,aAA7C,EAA4D;AAC1D,eAAO/K,KAAK,CAACgL,oBAAN,EAAP;AACD;;AAEDhL,MAAAA,KAAK,CAACiC,QAAN,CAAe;AACbvB,QAAAA,gBAAgB,EAAE;AADL,OAAf;;AAIA,UAAIV,KAAK,CAAC+C,KAAN,CAAYhC,0BAAZ,IAA0Cf,KAAK,CAACtD,KAAN,CAAYqO,aAA1D,EAAyE;AACvE/K,QAAAA,KAAK,CAACqD,YAAN;AACD,OAFD,MAEO,IAAIrD,KAAK,CAAC+C,KAAN,CAAY/B,qBAAZ,IAAqChB,KAAK,CAACtD,KAAN,CAAYqO,aAArD,EAAoE;AACzE/K,QAAAA,KAAK,CAACgL,oBAAN;AACD;AACF,KAlBc,CAAf;;AAoBA9O,IAAAA,eAAe,CAACqC,sBAAsB,CAACyB,KAAD,CAAvB,EAAgC,wBAAhC,EAA0D,YAAY;AACnF,UAAIA,KAAK,CAACuF,WAAN,CAAkB0F,MAAlB,IAA4B,CAACjL,KAAK,CAACtD,KAAN,CAAYwO,kBAA7C,EAAiE;AAC/DlL,QAAAA,KAAK,CAACuF,WAAN,CAAkBG,IAAlB;AACD,OAHkF,CAGjF;;;AAGF,UAAI,CAAC1F,KAAK,CAACtD,KAAN,CAAYiJ,6BAAjB,EAAgD;AAC9C3F,QAAAA,KAAK,CAACiC,QAAN,CAAe;AACbtB,UAAAA,kBAAkB,EAAE,CAACX,KAAK,CAAC+C,KAAN,CAAYpC;AADpB,SAAf;AAGD;AACF,KAXc,CAAf;;AAaA,WAAOX,KAAP;AACD;;AAEDlD,EAAAA,YAAY,CAAC+C,aAAD,EAAgB,CAAC;AAC3BtF,IAAAA,GAAG,EAAE,mBADsB;AAE3B3B,IAAAA,KAAK,EAAE,SAASuS,iBAAT,GAA6B;AAClC,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIrK,0BAA0B,GAAG,CAAC,CAAC4C,MAAM,CAACc,aAAT,IAA0B,CAAC,CAAClD,SAAS,CAACC,YAAvE;AACA,UAAIR,qBAAqB,GAAGqK,QAAQ,CAACC,aAAT,CAAuB,OAAvB,EAAgCC,OAAhC,KAA4CrK,SAAxE;AACA,WAAKe,QAAL,CAAc;AACZlB,QAAAA,0BAA0B,EAAEA,0BADhB;AAEZC,QAAAA,qBAAqB,EAAEA;AAFX,OAAd,EAGG,YAAY;AACb,YAAIoK,MAAM,CAAC1O,KAAP,CAAaoO,aAAb,IAA8BM,MAAM,CAAC1O,KAAP,CAAaqO,aAA/C,EAA8D;AAC5DK,UAAAA,MAAM,CAACJ,oBAAP;AACD,SAFD,MAEO,IAAII,MAAM,CAACrI,KAAP,CAAahC,0BAAb,IAA2CqK,MAAM,CAAC1O,KAAP,CAAaqO,aAA5D,EAA2E;AAChFK,UAAAA,MAAM,CAAC/H,YAAP;AACD,SAFM,MAEA,IAAI+H,MAAM,CAACrI,KAAP,CAAa/B,qBAAb,IAAsCoK,MAAM,CAAC1O,KAAP,CAAaqO,aAAvD,EAAsE;AAC3EK,UAAAA,MAAM,CAACJ,oBAAP;AACD;AACF,OAXD;AAYD;AAnB0B,GAAD,EAoBzB;AACDzQ,IAAAA,GAAG,EAAE,oBADJ;AAED3B,IAAAA,KAAK,EAAE,SAAS4S,kBAAT,CAA4BC,SAA5B,EAAuCC,SAAvC,EAAkD;AACvD,UAAI,KAAKnG,WAAL,IAAoB,KAAKxC,KAAL,CAAWrC,gBAA/B,IAAmD,CAACgL,SAAS,CAAChL,gBAAlE,EAAoF;AAClF,aAAKiL,sBAAL;AACD;AACF;AANA,GApByB,EA2BzB;AACDpR,IAAAA,GAAG,EAAE,sBADJ;AAED3B,IAAAA,KAAK,EAAE,SAASgT,oBAAT,GAAgC;AACrC,WAAKxH,aAAL;AACA,WAAKX,oBAAL,GAA4B,IAA5B;AACD;AALA,GA3ByB,EAiCzB;AACDlJ,IAAAA,GAAG,EAAE,kBADJ;AAED3B,IAAAA,KAAK,EAAE,SAASiT,gBAAT,GAA4B;AACjC,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIC,YAAY,GAAG,KAAKrP,KAAxB;AAAA,UACIsP,mBAAmB,GAAGD,YAAY,CAACC,mBADvC;AAAA,UAEId,kBAAkB,GAAGa,YAAY,CAACb,kBAFtC;AAAA,UAGIe,iBAAiB,GAAGF,YAAY,CAACE,iBAHrC;AAAA,UAIIC,uBAAuB,GAAGH,YAAY,CAACG,uBAJ3C;AAAA,UAKIvG,6BAA6B,GAAGoG,YAAY,CAACpG,6BALjD;AAAA,UAMIwG,sBAAsB,GAAGJ,YAAY,CAACI,sBAN1C;AAAA,UAOIC,oBAAoB,GAAGL,YAAY,CAACK,oBAPxC;AAAA,UAQIC,qBAAqB,GAAGN,YAAY,CAACM,qBARzC;AAAA,UASIC,eAAe,GAAGP,YAAY,CAACO,eATnC;AAAA,UAUIC,iBAAiB,GAAGR,YAAY,CAACQ,iBAVrC;AAAA,UAWIzB,aAAa,GAAGiB,YAAY,CAACjB,aAXjC;AAAA,UAYI0B,cAAc,GAAGT,YAAY,CAACS,cAZlC;AAaA,UAAIC,YAAY,GAAG,KAAK1J,KAAxB;AAAA,UACI/B,qBAAqB,GAAGyL,YAAY,CAACzL,qBADzC;AAAA,UAEIN,gBAAgB,GAAG+L,YAAY,CAAC/L,gBAFpC;AAAA,UAGIK,0BAA0B,GAAG0L,YAAY,CAAC1L,0BAH9C;AAAA,UAIIH,eAAe,GAAG6L,YAAY,CAAC7L,eAJnC;AAAA,UAKIC,KAAK,GAAG4L,YAAY,CAAC5L,KALzB;AAAA,UAMIL,UAAU,GAAGiM,YAAY,CAACjM,UAN9B;AAAA,UAOIC,YAAY,GAAGgM,YAAY,CAAChM,YAPhC;AAAA,UAQIE,kBAAkB,GAAG8L,YAAY,CAAC9L,kBARtC;AAAA,UASIJ,WAAW,GAAGkM,YAAY,CAAClM,WAT/B;AAAA,UAUIa,kBAAkB,GAAGqL,YAAY,CAACrL,kBAVtC;AAWA,UAAIsL,mBAAmB,GAAG5B,aAAa,IAAI,CAAC/J,0BAAD,IAA+BC,qBAA1E;AACA,UAAIyJ,UAAU,GAAGiC,mBAAmB,GAAG,aAAa7T,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC,OAAhC,EAAyC;AAC3FqB,QAAAA,GAAG,EAAE,KAAKlC,UADiF;AAE3FlQ,QAAAA,GAAG,EAAE,YAFsF;AAG3F6K,QAAAA,IAAI,EAAE,MAHqF;AAI3FwH,QAAAA,MAAM,EAAE,SAJmF;AAK3FrB,QAAAA,OAAO,EAAET,aAAa,GAAG5J,SAAH,GAAe,MALsD;AAM3F2L,QAAAA,KAAK,EAAE;AACLC,UAAAA,OAAO,EAAE;AADJ,SANoF;AAS3FC,QAAAA,QAAQ,EAAE,KAAKnC;AAT4E,OAAzC,CAAhB,GAU/B,IAVL;;AAYA,UAAIlK,gBAAJ,EAAsB;AACpB,eAAO,aAAa7H,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC9L,UAAhC,EAA4C;AAC9DjF,UAAAA,GAAG,EAAE,QADyD;AAE9DyS,UAAAA,SAAS,EAAEhB;AAFmD,SAA5C,EAGjB,aAAanT,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC7L,KAAhC,EAAuC;AACrDkN,UAAAA,GAAG,EAAE,SAASA,GAAT,CAAaM,EAAb,EAAiB;AACpB,mBAAOnB,MAAM,CAACvG,WAAP,GAAqB0H,EAA5B;AACD,WAHoD;AAIrDD,UAAAA,SAAS,EAAER,cAJ0C;AAKrDzI,UAAAA,GAAG,EAAE,KAAKhB,KAAL,CAAWiF,QALqC;AAMrDnC,UAAAA,IAAI,EAAE,IAN+C;AAOrDL,UAAAA,KAAK,EAAE7E,kBAP8C;AAQrDuM,UAAAA,WAAW,EAAE,IARwC;AASrDC,UAAAA,QAAQ,EAAE,CAACxH,6BAT0C;AAUrDyH,UAAAA,QAAQ,EAAElC,kBAV2C;AAWrDtL,UAAAA,OAAO,EAAE,KAAKyN,sBAXuC;AAYrDC,UAAAA,gBAAgB,EAAE,KAAKC,oBAZ8B;AAarDC,UAAAA,YAAY,EAAEvB,iBAbuC;AAcrDC,UAAAA,uBAAuB,EAAEA;AAd4B,SAAvC,CAHI,EAkBhBzB,UAlBgB,CAApB;AAmBD;;AAED,UAAIiC,mBAAJ,EAAyB;AACvB,eAAON,oBAAoB,CAAC;AAC1B3B,UAAAA,UAAU,EAAEA;AADc,SAAD,CAA3B;AAGD;;AAED,UAAI,CAAC1J,0BAAL,EAAiC;AAC/B,eAAOsL,qBAAqB,EAA5B;AACD;;AAED,UAAIzL,eAAJ,EAAqB;AACnB,eAAO0L,eAAe,CAAC;AACrBzL,UAAAA,KAAK,EAAEA;AADc,SAAD,CAAtB;AAGD;;AAED,UAAIL,UAAJ,EAAgB;AACd;AACA,YAAIiN,mBAAmB,GAAGrM,kBAAkB,IAAIA,kBAAkB,CAACrF,MAAnB,IAA6B,CAAnD,IAAwD,CAACwE,WAAzD,GAAuE,aAAa1H,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC9R,iBAAiB,CAAC,SAAD,CAAjD,EAA8D;AAC1KoG,UAAAA,OAAO,EAAE,KAAK8N;AAD4J,SAA9D,CAApF,GAErB,IAFL;AAGA,eAAO,aAAa7U,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC9L,UAAhC,EAA4C;AAC9DjF,UAAAA,GAAG,EAAE;AADyD,SAA5C,EAEjB,aAAa1B,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC7L,KAAhC,EAAuC;AACrDC,UAAAA,SAAS,EAAE,KAAKhD,KAAL,CAAWgD,SAD+B;AAErDiN,UAAAA,GAAG,EAAE,SAASA,GAAT,CAAaM,EAAb,EAAiB;AACpB,mBAAOnB,MAAM,CAACjI,WAAP,GAAqBoJ,EAA5B;AACD,WAJoD;AAKrDE,UAAAA,QAAQ,EAAE,IAL2C;AAMrD3H,UAAAA,KAAK,EAAE,IAN8C;AAOrD0H,UAAAA,WAAW,EAAE;AAPwC,SAAvC,CAFI,EAUhBO,mBAVgB,CAApB;AAWD;;AAED,UAAIhN,YAAJ,EAAkB;AAChB,eAAO8L,iBAAiB,EAAxB;AACD;;AAED,aAAOJ,sBAAsB,EAA7B;AACD;AAvGA,GAjCyB,EAyIzB;AACD5R,IAAAA,GAAG,EAAE,QADJ;AAED3B,IAAAA,KAAK,EAAE,SAAS+U,MAAT,GAAkB;AACvB,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIC,YAAY,GAAG,KAAK9K,KAAxB;AAAA,UACI/B,qBAAqB,GAAG6M,YAAY,CAAC7M,qBADzC;AAAA,UAEID,0BAA0B,GAAG8M,YAAY,CAAC9M,0BAF9C;AAAA,UAGIH,eAAe,GAAGiN,YAAY,CAACjN,eAHnC;AAAA,UAIIL,WAAW,GAAGsN,YAAY,CAACtN,WAJ/B;AAAA,UAKIC,UAAU,GAAGqN,YAAY,CAACrN,UAL9B;AAAA,UAMIM,aAAa,GAAG+M,YAAY,CAAC/M,aANjC;AAAA,UAOIL,YAAY,GAAGoN,YAAY,CAACpN,YAPhC;AAAA,UAQI4F,kBAAkB,GAAGwH,YAAY,CAACxH,kBARtC;AAAA,UASI3F,gBAAgB,GAAGmN,YAAY,CAACnN,gBATpC;AAAA,UAUIC,kBAAkB,GAAGkN,YAAY,CAAClN,kBAVtC;AAWA,UAAImN,YAAY,GAAG,KAAKpR,KAAxB;AAAA,UACI6J,aAAa,GAAGuH,YAAY,CAACvH,aADjC;AAAA,UAEIU,SAAS,GAAG6G,YAAY,CAAC7G,SAF7B;AAAA,UAGIiE,kBAAkB,GAAG4C,YAAY,CAAC5C,kBAHtC;AAAA,UAIIvF,6BAA6B,GAAGmI,YAAY,CAACnI,6BAJjD;AAAA,UAKIoI,aAAa,GAAGD,YAAY,CAACC,aALjC;AAAA,UAMIC,CAAC,GAAGF,YAAY,CAACE,CANrB;AAAA,UAOIlD,aAAa,GAAGgD,YAAY,CAAChD,aAPjC;AAAA,UAQImD,gBAAgB,GAAGH,YAAY,CAACG,gBARpC;AASA,aAAO,aAAapV,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgCnM,OAAhC,EAAyC;AAC3D6N,QAAAA,SAAS,EAAEiB;AADgD,OAAzC,EAEjB,KAAKpC,gBAAL,EAFiB,EAEQkC,aAAa,CAAC;AACxCC,QAAAA,CAAC,EAAEA,CADqC;AAExChN,QAAAA,qBAAqB,EAAEA,qBAFiB;AAGxCD,QAAAA,0BAA0B,EAAEA,0BAHY;AAIxCH,QAAAA,eAAe,EAAEA,eAJuB;AAKxCL,QAAAA,WAAW,EAAEA,WAL2B;AAMxCC,QAAAA,UAAU,EAAEA,UAN4B;AAOxCM,QAAAA,aAAa,EAAEA,aAPyB;AAQxCL,QAAAA,YAAY,EAAEA,YAR0B;AASxC4F,QAAAA,kBAAkB,EAAEA,kBAToB;AAUxC3F,QAAAA,gBAAgB,EAAEA,gBAVsB;AAWxCC,QAAAA,kBAAkB,EAAEA,kBAXoB;AAYxC4F,QAAAA,aAAa,EAAEA,aAZyB;AAaxCU,QAAAA,SAAS,EAAEA,SAb6B;AAcxCiE,QAAAA,kBAAkB,EAAEA,kBAdoB;AAexCvF,QAAAA,6BAA6B,EAAEA,6BAfS;AAgBxCmF,QAAAA,aAAa,EAAEA,aAhByB;AAiBxCxJ,QAAAA,cAAc,EAAE,SAASA,cAAT,GAA0B;AACxC,iBAAOsM,MAAM,CAACvK,YAAP,EAAP;AACD,SAnBuC;AAoBxCR,QAAAA,cAAc,EAAE,KAAK6K,kBApBmB;AAqBxCpK,QAAAA,eAAe,EAAE,KAAKc,aArBkB;AAsBxCoG,QAAAA,gBAAgB,EAAE,KAAKQ,oBAtBiB;AAuBxC5E,QAAAA,gBAAgB,EAAE,KAAK8H,oBAvBiB;AAwBxCnI,QAAAA,eAAe,EAAE,KAAKqB,mBAxBkB;AAyBxCnB,QAAAA,gBAAgB,EAAE,KAAKkI,oBAzBiB;AA0BxCjI,QAAAA,iBAAiB,EAAE,KAAKkI,qBA1BgB;AA2BxCvD,QAAAA,eAAe,EAAE,KAAKwD;AA3BkB,OAAD,CAFrB,CAApB;AA+BD;AAxDA,GAzIyB,CAAhB,CAAZ;;AAoMA,SAAOxO,aAAP;AACD,CA7tBgC,CA6tB/BhH,MAAM,CAACyV,SA7tBwB,CAAjC;;AA+tBA3V,OAAO,CAAC,SAAD,CAAP,GAAqBkH,aAArB;;AAEA3D,eAAe,CAAC2D,aAAD,EAAgB,WAAhB,EAA6B;AAC1C;AACAkL,EAAAA,aAAa,EAAE/R,UAAU,CAAC,SAAD,CAAV,CAAsBuV,IAFK;;AAI1C;AACA7O,EAAAA,SAAS,EAAE1G,UAAU,CAAC,SAAD,CAAV,CAAsBuV,IALS;;AAO1C;AACA/J,EAAAA,QAAQ,EAAExL,UAAU,CAAC,SAAD,CAAV,CAAsBwV,MARU;;AAU1C;AACAjI,EAAAA,aAAa,EAAEvN,UAAU,CAAC,SAAD,CAAV,CAAsByV,MAXK;;AAa1C;AACAxH,EAAAA,SAAS,EAAEjO,UAAU,CAAC,SAAD,CAAV,CAAsByV,MAdS;;AAgB1C;AACAvD,EAAAA,kBAAkB,EAAElS,UAAU,CAAC,SAAD,CAAV,CAAsBuV,IAjBA;;AAmB1C;AACA5I,EAAAA,6BAA6B,EAAE3M,UAAU,CAAC,SAAD,CAAV,CAAsBuV,IApBX;;AAsB1C;AACAlM,EAAAA,WAAW,EAAErJ,UAAU,CAAC,SAAD,CAAV,CAAsB0V,KAAtB,CAA4B;AACvCzP,IAAAA,KAAK,EAAEjG,UAAU,CAAC,SAAD,CAAV,CAAsB2V,GADU;AAEvCzP,IAAAA,KAAK,EAAElG,UAAU,CAAC,SAAD,CAAV,CAAsB2V;AAFU,GAA5B,CAvB6B;AA2B1C7J,EAAAA,SAAS,EAAE9L,UAAU,CAAC,SAAD,CAAV,CAAsByV,MA3BS;AA4B1CvH,EAAAA,oBAAoB,EAAElO,UAAU,CAAC,SAAD,CAAV,CAAsByV,MA5BF;AA6B1C3D,EAAAA,aAAa,EAAE9R,UAAU,CAAC,SAAD,CAAV,CAAsBuV,IA7BK;;AA+B1C;AACAtC,EAAAA,iBAAiB,EAAEjT,UAAU,CAAC,SAAD,CAAV,CAAsBwV,MAhCC;;AAkC1C;AACAtC,EAAAA,uBAAuB,EAAElT,UAAU,CAAC,SAAD,CAAV,CAAsBuV,IAnCL;AAoC1CpC,EAAAA,sBAAsB,EAAEnT,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IApCJ;AAqC1CrC,EAAAA,iBAAiB,EAAEvT,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IArCC;AAsC1CxC,EAAAA,oBAAoB,EAAEpT,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAtCF;AAuC1CvC,EAAAA,qBAAqB,EAAErT,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAvCH;AAwC1CtC,EAAAA,eAAe,EAAEtT,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAxCG;AAyC1Cb,EAAAA,aAAa,EAAE/U,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAzCK;AA0C1C5C,EAAAA,mBAAmB,EAAEhT,UAAU,CAAC,SAAD,CAAV,CAAsBwV,MA1CD;AA2C1ChC,EAAAA,cAAc,EAAExT,UAAU,CAAC,SAAD,CAAV,CAAsBwV,MA3CI;AA4C1CP,EAAAA,gBAAgB,EAAEjV,UAAU,CAAC,SAAD,CAAV,CAAsBwV,MA5CE;;AA8C1C;AACAR,EAAAA,CAAC,EAAEhV,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IA/CiB;AAgD1ClL,EAAAA,UAAU,EAAE1K,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAhDQ;AAiD1CtN,EAAAA,cAAc,EAAEtI,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAjDI;AAkD1C/L,EAAAA,cAAc,EAAE7J,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAlDI;AAmD1CtL,EAAAA,eAAe,EAAEtK,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAnDG;AAoD1CxI,EAAAA,gBAAgB,EAAEpN,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IApDE;AAqD1C7I,EAAAA,eAAe,EAAE/M,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IArDG;AAsD1C3I,EAAAA,gBAAgB,EAAEjN,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAtDE;AAuD1C1I,EAAAA,iBAAiB,EAAElN,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAvDC;AAwD1C1G,EAAAA,mBAAmB,EAAElP,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAxDD;AAyD1CpE,EAAAA,gBAAgB,EAAExR,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IAzDE;AA0D1C/D,EAAAA,eAAe,EAAE7R,UAAU,CAAC,SAAD,CAAV,CAAsB4V,IA1DG;AA2D1C3K,EAAAA,OAAO,EAAEjL,UAAU,CAAC,SAAD,CAAV,CAAsB4V;AA3DW,CAA7B,CAAf;;AA8DA1S,eAAe,CAAC2D,aAAD,EAAgB,cAAhB,EAAgC;AAC7CwM,EAAAA,qBAAqB,EAAE,SAASA,qBAAT,GAAiC;AACtD,WAAO,aAAaxT,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgClS,gBAAgB,CAAC,SAAD,CAAhD,EAA6D,IAA7D,CAApB;AACD,GAH4C;AAI7CkT,EAAAA,eAAe,EAAE,SAASA,eAAT,GAA2B;AAC1C,WAAO,aAAazT,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgCjS,UAAU,CAAC,SAAD,CAA1C,EAAuD,IAAvD,CAApB;AACD,GAN4C;AAO7C+S,EAAAA,oBAAoB,EAAE,SAASA,oBAAT,CAA8ByC,KAA9B,EAAqC;AACzD,QAAIpE,UAAU,GAAGoE,KAAK,CAACpE,UAAvB;AACA,WAAO,aAAa5R,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgCzS,MAAM,CAAC,SAAD,CAAN,CAAkBiW,QAAlD,EAA4D,IAA5D,EAAkErE,UAAlE,CAApB;AACD,GAV4C;AAW7C0B,EAAAA,sBAAsB,EAAE,SAASA,sBAAT,GAAkC;AACxD,WAAO,aAAatT,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgChS,iBAAiB,CAAC,SAAD,CAAjD,EAA8D,IAA9D,CAApB;AACD,GAb4C;AAc7CiT,EAAAA,iBAAiB,EAAE,SAASA,iBAAT,GAA6B;AAC9C,WAAO,aAAa1T,MAAM,CAAC,SAAD,CAAN,CAAkByS,aAAlB,CAAgC/R,YAAY,CAAC,SAAD,CAA5C,EAAyD,IAAzD,CAApB;AACD,GAhB4C;AAiB7CyU,EAAAA,CAAC,EAAE,SAASA,CAAT,CAAWpM,CAAX,EAAc;AACf,WAAOA,CAAP;AACD,GAnB4C;AAoB7CmM,EAAAA,aAAa,EAAEtU,cAAc,CAAC,SAAD,CApBgB;AAqB7CiG,EAAAA,SAAS,EAAE,IArBkC;AAsB7C6G,EAAAA,aAAa,EAAE,IAtB8B;AAuB7ClE,EAAAA,WAAW,EAAErD,WAvBgC;AAwB7C8F,EAAAA,SAAS,EAAE,GAxBkC;AAyB7CoC,EAAAA,oBAAoB,EAAE;AAzBuB,CAAhC,CAAf","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _styledComponents = _interopRequireWildcard(require(\"styled-components\"));\n\nvar _tsEbml = require(\"ts-ebml\");\n\nvar _unsupportedView = _interopRequireDefault(require(\"./defaults/unsupported-view\"));\n\nvar _errorView = _interopRequireDefault(require(\"./defaults/error-view\"));\n\nvar _disconnectedView = _interopRequireDefault(require(\"./defaults/disconnected-view\"));\n\nvar _loadingView = _interopRequireDefault(require(\"./defaults/loading-view\"));\n\nvar _switchCameraView = _interopRequireDefault(require(\"./defaults/switch-camera-view\"));\n\nvar _renderActions = _interopRequireDefault(require(\"./defaults/render-actions\"));\n\nvar _getVideoInfo = _interopRequireWildcard(require(\"./get-video-info\"));\n\nvar _customErrors = require(\"./custom-errors\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar MIME_TYPES = ['video/webm;codecs=\"vp8,opus\"', 'video/webm;codecs=h264', 'video/webm;codecs=vp9', 'video/webm', 'video/mp4'];\nvar CONSTRAINTS = {\n  audio: true,\n  video: true\n};\n\nvar Wrapper = _styledComponents[\"default\"].div.withConfig({\n  displayName: \"video-recorder__Wrapper\",\n  componentId: \"sc-7k20rv-0\"\n})([\"position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;overflow:hidden;min-height:300px;background-color:#000;color:white;box-sizing:border-box;*{box-sizing:inherit;}\"]);\n\nvar CameraView = _styledComponents[\"default\"].div.withConfig({\n  displayName: \"video-recorder__CameraView\",\n  componentId: \"sc-7k20rv-1\"\n})([\"width:100%;height:100%;\"]);\n\nvar Video = _styledComponents[\"default\"].video.withConfig({\n  displayName: \"video-recorder__Video\",\n  componentId: \"sc-7k20rv-2\"\n})([\"position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;\", \";\", \";\"], function (props) {\n  return props.isFlipped && (0, _styledComponents.css)([\"transform:translate(-50%,-50%) scaleX(-1);\"]);\n}, function (props) {\n  return props.onClick && (0, _styledComponents.css)([\"cursor:pointer;\"]);\n});\n\nvar VideoRecorder = /*#__PURE__*/function (_Component) {\n  _inherits(VideoRecorder, _Component);\n\n  var _super = _createSuper(VideoRecorder);\n\n  function VideoRecorder() {\n    var _this;\n\n    _classCallCheck(this, VideoRecorder);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"videoInput\", /*#__PURE__*/_react[\"default\"].createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"isComponentUnmounted\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"timeSinceInactivity\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isRecording: false,\n      isCameraOn: false,\n      isConnecting: false,\n      isReplayingVideo: false,\n      isReplayVideoMuted: true,\n      thereWasAnError: false,\n      error: null,\n      streamIsReady: false,\n      isInlineRecordingSupported: null,\n      isVideoInputSupported: null,\n      stream: undefined,\n      currentDeviceId: null,\n      availableDeviceIds: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"turnOnCamera\", function () {\n      var deviceId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n      if (_this.props.onTurnOnCamera) {\n        _this.props.onTurnOnCamera();\n      }\n\n      navigator.mediaDevices.enumerateDevices().then(function (mediaDevices) {\n        var videoDevices = mediaDevices.filter(function (x) {\n          return x.kind === 'videoinput';\n        });\n\n        if (deviceId && videoDevices[0] && videoDevices.find(function (x) {\n          return x.deviceId;\n        }) === undefined) {\n          return _this.handleError(new _customErrors.ReactVideoRecorderDeviceUnavailableError());\n        }\n\n        var currentDeviceId = typeof deviceId === 'string' ? deviceId : videoDevices[0].deviceId;\n\n        _this.setState({\n          isConnecting: true,\n          isReplayingVideo: false,\n          thereWasAnError: false,\n          currentDeviceId: currentDeviceId,\n          availableDeviceIds: videoDevices.map(function (x) {\n            return x.deviceId;\n          }),\n          error: null\n        });\n\n        var fallbackContraints = {\n          audio: true,\n          video: true\n        };\n\n        var currentConstraints = _objectSpread(_objectSpread({}, _this.props.constraints), {}, {\n          video: {\n            deviceId: {\n              exact: currentDeviceId\n            }\n          }\n        });\n\n        navigator.mediaDevices.getUserMedia(currentConstraints)[\"catch\"](function (err) {\n          // there's a bug in chrome in some windows computers where using `ideal` in the constraints throws a NotReadableError\n          if (err.name === 'NotReadableError' || err.name === 'OverconstrainedError') {\n            console.warn(\"Got \".concat(err.name, \", trying getUserMedia again with fallback constraints\"));\n            return navigator.mediaDevices.getUserMedia(fallbackContraints);\n          }\n\n          throw err;\n        }).then(_this.handleSuccess)[\"catch\"](_this.handleError);\n      })[\"catch\"](_this.handleError);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSwitchCamera\", function () {\n      if (_this.props.onSwitchCamera) {\n        _this.props.onSwitchCamera();\n      }\n\n      var _this$state = _this.state,\n          currentDeviceId = _this$state.currentDeviceId,\n          availableDeviceIds = _this$state.availableDeviceIds; // Stop media tracks\n\n      _this.stream && _this.stream.getTracks().forEach(function (stream) {\n        return stream.stop();\n      });\n      var index = availableDeviceIds.findIndex(function (x) {\n        return x === currentDeviceId;\n      });\n      var maxIndex = availableDeviceIds.length - 1;\n\n      if (index < 0) {\n        return _this.handleError(new _customErrors.ReactVideoRecorderDeviceUnavailableError());\n      }\n\n      if (index + 1 > maxIndex) return _this.turnOnCamera(availableDeviceIds[0]);\n      return _this.turnOnCamera(availableDeviceIds[index + 1]);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"turnOffCamera\", function () {\n      if (_this.props.onTurnOffCamera) {\n        _this.props.onTurnOffCamera();\n      }\n\n      _this.stream && _this.stream.getTracks().forEach(function (stream) {\n        return stream.stop();\n      });\n\n      _this.setState({\n        isCameraOn: false\n      });\n\n      clearInterval(_this.inactivityTimer);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSuccess\", function (stream) {\n      // Since handleSuccess is an async function, we may be in a situation where this was called after the\n      // component was unmounted\n      if (_this.isComponentUnmounted) {\n        return;\n      }\n\n      _this.stream = stream;\n\n      _this.setState({\n        isCameraOn: true,\n        stream: stream\n      });\n\n      if (_this.props.onCameraOn) {\n        _this.props.onCameraOn();\n      }\n\n      if (window.URL) {\n        _this.cameraVideo.srcObject = stream;\n      } else {\n        _this.cameraVideo.src = stream;\n      } // there is probably a better way\n      // but this makes sure the start recording button\n      // gives the stream a couple miliseconds to be ready\n\n\n      setTimeout(function () {\n        _this.setState({\n          isConnecting: false,\n          streamIsReady: true\n        });\n      }, 200);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleError\", function (err) {\n      var onError = _this.props.onError;\n\n      if (onError) {\n        onError(err);\n      }\n\n      if (_this.isComponentUnmounted) {\n        return;\n      }\n\n      console.error('Captured error', err);\n      clearTimeout(_this.timeLimitTimeout);\n\n      _this.setState({\n        isConnecting: _this.state.isConnecting && false,\n        isRecording: false,\n        thereWasAnError: true,\n        error: err\n      });\n\n      if (_this.state.isCameraOn) {\n        _this.turnOffCamera();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDataIssue\", function (event) {\n      var error = new _customErrors.ReactVideoRecorderDataIssueError(event);\n      console.error(error.message, event);\n\n      _this.handleError(error);\n\n      return false;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getMimeType\", function () {\n      if (_this.props.mimeType) {\n        return _this.props.mimeType;\n      }\n\n      var mimeType = window.MediaRecorder.isTypeSupported ? MIME_TYPES.find(window.MediaRecorder.isTypeSupported) : 'video/webm';\n      return _this.mediaRecorder && _this.mediaRecorder.mimeType || mimeType || '';\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isDataHealthOK\", function (event) {\n      if (!event.data) return _this.handleDataIssue(event);\n      var chunkSize = _this.props.chunkSize;\n      var dataCheckInterval = 2000 / chunkSize; // in some browsers (FF/S), data only shows up\n      // after a certain amount of time ~everyt 2 seconds\n\n      var blobCount = _this.recordedBlobs.length;\n\n      if (blobCount > dataCheckInterval && blobCount % dataCheckInterval === 0) {\n        var blob = new window.Blob(_this.recordedBlobs, {\n          type: _this.getMimeType()\n        });\n        if (blob.size <= 0) return _this.handleDataIssue(event);\n      }\n\n      return true;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"tryToUnmuteReplayVideo\", function () {\n      var video = _this.replayVideo;\n      video.muted = false;\n      var playPromise = video.play();\n\n      if (!playPromise) {\n        video.muted = true;\n        return;\n      }\n\n      playPromise.then(function () {\n        _this.setState({\n          isReplayVideoMuted: false\n        }); // fixes bug where seeking control during autoplay is not available until the video is almost completely played through\n\n\n        if (_this.props.replayVideoAutoplayAndLoopOff) {\n          video.pause();\n          video.loop = false;\n        }\n      })[\"catch\"](function (err) {\n        console.warn('Could not autoplay replay video', err);\n        video.muted = true;\n        return video.play();\n      })[\"catch\"](function (err) {\n        console.warn('Could play muted replay video after failed autoplay', err);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDataAvailable\", function (event) {\n      if (_this.isDataHealthOK(event)) {\n        _this.recordedBlobs.push(event.data);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStopRecording\", function () {\n      if (_this.props.onStopRecording) {\n        _this.props.onStopRecording();\n      }\n\n      if (!_this.mediaRecorder) {\n        _this.handleError(new _customErrors.ReactVideoRecorderMediaRecorderUnavailableError());\n\n        return;\n      }\n\n      _this.mediaRecorder.stop();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handlePauseRecording\", function () {\n      if (_this.props.onPauseRecording) {\n        _this.props.onPauseRecording();\n      }\n\n      if (!_this.mediaRecorder) {\n        _this.handleError(new _customErrors.ReactVideoRecorderMediaRecorderUnavailableError());\n\n        return;\n      }\n\n      _this.mediaRecorder.pause();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleResumeRecording\", function () {\n      if (_this.props.onResumeRecording) {\n        _this.props.onResumeRecording();\n      }\n\n      if (!_this.mediaRecorder) {\n        _this.handleError(new _customErrors.ReactVideoRecorderMediaRecorderUnavailableError());\n\n        return;\n      }\n\n      _this.mediaRecorder.resume();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStartRecording\", function () {\n      if (_this.props.onStartRecording) {\n        _this.props.onStartRecording();\n      }\n\n      _this.setState({\n        isRunningCountdown: true,\n        isReplayingVideo: false\n      });\n\n      setTimeout(function () {\n        return _this.startRecording();\n      }, _this.props.countdownTime);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"startRecording\", function () {\n      (0, _getVideoInfo.captureThumb)(_this.cameraVideo).then(function (thumbnail) {\n        _this.thumbnail = thumbnail;\n        _this.recordedBlobs = [];\n        var options = {\n          mimeType: _this.getMimeType()\n        };\n\n        try {\n          _this.setState({\n            isRunningCountdown: false,\n            isRecording: true\n          });\n\n          _this.startedAt = new Date().getTime();\n          _this.mediaRecorder = new window.MediaRecorder(_this.stream, options);\n\n          _this.mediaRecorder.addEventListener('stop', _this.handleStop);\n\n          _this.mediaRecorder.addEventListener('error', _this.handleError);\n\n          _this.mediaRecorder.addEventListener('dataavailable', _this.handleDataAvailable);\n\n          var _this$props = _this.props,\n              timeLimit = _this$props.timeLimit,\n              chunkSize = _this$props.chunkSize,\n              dataAvailableTimeout = _this$props.dataAvailableTimeout;\n\n          _this.mediaRecorder.start(chunkSize); // collect 10ms of data\n\n\n          if (timeLimit) {\n            _this.timeLimitTimeout = setTimeout(function () {\n              _this.handleStopRecording();\n            }, timeLimit);\n          } // mediaRecorder.ondataavailable should be called every 10ms,\n          // as that's what we're passing to mediaRecorder.start() above\n\n\n          if (Number.isInteger(dataAvailableTimeout)) {\n            setTimeout(function () {\n              if (_this.recordedBlobs.length === 0) {\n                _this.handleError(new _customErrors.ReactVideoRecorderDataAvailableTimeoutError(dataAvailableTimeout));\n              }\n            }, dataAvailableTimeout);\n          }\n        } catch (err) {\n          console.error(\"Couldn't create MediaRecorder\", err, options);\n\n          _this.handleError(err);\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStop\", function (event) {\n      var endedAt = new Date().getTime();\n\n      if (!_this.recordedBlobs || _this.recordedBlobs.length <= 0) {\n        var error = new _customErrors.ReactVideoRecorderRecordedBlobsUnavailableError(event);\n        console.error(error.message, event);\n\n        _this.handleError(error);\n\n        return;\n      }\n\n      clearTimeout(_this.timeLimitTimeout);\n      var videoBlob = _this.recordedBlobs.length === 1 ? _this.recordedBlobs[0] : new window.Blob(_this.recordedBlobs, {\n        type: _this.getMimeType()\n      });\n      var thumbnailBlob = _this.thumbnail;\n      var startedAt = _this.startedAt;\n      var duration = endedAt - startedAt; // if this gets executed too soon, the last chunk of data is lost on FF\n\n      _this.mediaRecorder.ondataavailable = null;\n\n      _this.fixVideoMetadata(videoBlob).then(function (fixedVideoBlob) {\n        _this.setState({\n          isRecording: false,\n          isReplayingVideo: true,\n          isReplayVideoMuted: true,\n          fixedVideoBlob: fixedVideoBlob,\n          videoUrl: window.URL.createObjectURL(fixedVideoBlob)\n        });\n\n        _this.turnOffCamera();\n\n        _this.props.onRecordingComplete(fixedVideoBlob, startedAt, thumbnailBlob, duration);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fixVideoMetadata\", function (rawVideoBlob) {\n      var _Blob$prototype, _Blob$prototype$array;\n\n      var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n      if (isSafari) {\n        return Promise.resolve(rawVideoBlob);\n      } // see https://stackoverflow.com/a/63568311\n\n\n      (_Blob$prototype$array = (_Blob$prototype = Blob.prototype).arrayBuffer) !== null && _Blob$prototype$array !== void 0 ? _Blob$prototype$array : _Blob$prototype.arrayBuffer = function () {\n        return new Response(this).arrayBuffer();\n      };\n      return rawVideoBlob.arrayBuffer().then(function (buffer) {\n        var _elements;\n\n        var decoder = new _tsEbml.Decoder();\n        var elements = decoder.decode(buffer); // see https://github.com/legokichi/ts-ebml/issues/33#issuecomment-888800828\n\n        var validEmlType = ['m', 'u', 'i', 'f', 's', '8', 'b', 'd'];\n        elements = (_elements = elements) === null || _elements === void 0 ? void 0 : _elements.filter(function (elm) {\n          return validEmlType.includes(elm.type);\n        });\n        var reader = new _tsEbml.Reader();\n        reader.logging = false;\n        reader.drop_default_duration = false;\n        elements.forEach(function (element) {\n          return reader.read(element);\n        });\n        reader.stop();\n\n        var seekableMetadata = _tsEbml.tools.makeMetadataSeekable(reader.metadatas, reader.duration, reader.cues);\n\n        var blobBody = buffer.slice(reader.metadataSize);\n        var result = new Blob([seekableMetadata, blobBody], {\n          type: rawVideoBlob.type\n        });\n        return result;\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleVideoSelected\", function (e) {\n      if (_this.state.isReplayingVideo) {\n        _this.setState({\n          isReplayingVideo: false\n        });\n      }\n\n      var files = e.target.files || e.dataTransfer.files;\n      if (files.length === 0) return;\n      var startedAt = new Date().getTime();\n      var video = files[0];\n      e.target.value = null;\n      var extension = video.type === 'video/quicktime' ? 'mov' : undefined;\n      (0, _getVideoInfo[\"default\"])(video).then(function (_ref) {\n        var duration = _ref.duration,\n            thumbnail = _ref.thumbnail;\n\n        _this.setState({\n          isRecording: false,\n          isReplayingVideo: true,\n          isReplayVideoMuted: true,\n          videoBlob: video,\n          videoUrl: window.URL.createObjectURL(video)\n        });\n\n        _this.props.onRecordingComplete(video, startedAt, thumbnail, duration, extension);\n      })[\"catch\"](function (err) {\n        _this.handleError(err);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOpenVideoInput\", function () {\n      if (_this.props.onOpenVideoInput) {\n        _this.props.onOpenVideoInput();\n      }\n\n      _this.videoInput.current.value = null;\n\n      _this.videoInput.current.click(); // fixes a bug on iPhone where it doesn't save the recorded video on the second time (if you press the 'Use another video' button)\n\n\n      _this.videoInput.current.addEventListener('change', _this.handleVideoSelected);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStopReplaying\", function () {\n      if (_this.props.onStopReplaying) {\n        _this.props.onStopReplaying();\n      }\n\n      if (_this.props.useVideoInput && _this.props.isOnInitially) {\n        return _this.handleOpenVideoInput();\n      }\n\n      _this.setState({\n        isReplayingVideo: false\n      });\n\n      if (_this.state.isInlineRecordingSupported && _this.props.isOnInitially) {\n        _this.turnOnCamera();\n      } else if (_this.state.isVideoInputSupported && _this.props.isOnInitially) {\n        _this.handleOpenVideoInput();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReplayVideoClick\", function () {\n      if (_this.replayVideo.paused && !_this.props.showReplayControls) {\n        _this.replayVideo.play();\n      } // fixes bug where seeking control during autoplay is not available until the video is almost completely played through\n\n\n      if (!_this.props.replayVideoAutoplayAndLoopOff) {\n        _this.setState({\n          isReplayVideoMuted: !_this.state.isReplayVideoMuted\n        });\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(VideoRecorder, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var isInlineRecordingSupported = !!window.MediaRecorder && !!navigator.mediaDevices;\n      var isVideoInputSupported = document.createElement('input').capture !== undefined;\n      this.setState({\n        isInlineRecordingSupported: isInlineRecordingSupported,\n        isVideoInputSupported: isVideoInputSupported\n      }, function () {\n        if (_this2.props.useVideoInput && _this2.props.isOnInitially) {\n          _this2.handleOpenVideoInput();\n        } else if (_this2.state.isInlineRecordingSupported && _this2.props.isOnInitially) {\n          _this2.turnOnCamera();\n        } else if (_this2.state.isVideoInputSupported && _this2.props.isOnInitially) {\n          _this2.handleOpenVideoInput();\n        }\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (this.replayVideo && this.state.isReplayingVideo && !prevState.isReplayingVideo) {\n        this.tryToUnmuteReplayVideo();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.turnOffCamera();\n      this.isComponentUnmounted = true;\n    }\n  }, {\n    key: \"renderCameraView\",\n    value: function renderCameraView() {\n      var _this3 = this;\n\n      var _this$props2 = this.props,\n          cameraViewClassName = _this$props2.cameraViewClassName,\n          showReplayControls = _this$props2.showReplayControls,\n          videoControlsList = _this$props2.videoControlsList,\n          disablePictureInPicture = _this$props2.disablePictureInPicture,\n          replayVideoAutoplayAndLoopOff = _this$props2.replayVideoAutoplayAndLoopOff,\n          renderDisconnectedView = _this$props2.renderDisconnectedView,\n          renderVideoInputView = _this$props2.renderVideoInputView,\n          renderUnsupportedView = _this$props2.renderUnsupportedView,\n          renderErrorView = _this$props2.renderErrorView,\n          renderLoadingView = _this$props2.renderLoadingView,\n          useVideoInput = _this$props2.useVideoInput,\n          videoClassName = _this$props2.videoClassName;\n      var _this$state2 = this.state,\n          isVideoInputSupported = _this$state2.isVideoInputSupported,\n          isReplayingVideo = _this$state2.isReplayingVideo,\n          isInlineRecordingSupported = _this$state2.isInlineRecordingSupported,\n          thereWasAnError = _this$state2.thereWasAnError,\n          error = _this$state2.error,\n          isCameraOn = _this$state2.isCameraOn,\n          isConnecting = _this$state2.isConnecting,\n          isReplayVideoMuted = _this$state2.isReplayVideoMuted,\n          isRecording = _this$state2.isRecording,\n          availableDeviceIds = _this$state2.availableDeviceIds;\n      var shouldUseVideoInput = useVideoInput || !isInlineRecordingSupported && isVideoInputSupported;\n      var videoInput = shouldUseVideoInput ? /*#__PURE__*/_react[\"default\"].createElement(\"input\", {\n        ref: this.videoInput,\n        key: \"videoInput\",\n        type: \"file\",\n        accept: \"video/*\",\n        capture: useVideoInput ? undefined : 'user',\n        style: {\n          display: 'none'\n        },\n        onChange: this.handleVideoSelected\n      }) : null;\n\n      if (isReplayingVideo) {\n        return /*#__PURE__*/_react[\"default\"].createElement(CameraView, {\n          key: \"replay\",\n          className: cameraViewClassName\n        }, /*#__PURE__*/_react[\"default\"].createElement(Video, {\n          ref: function ref(el) {\n            return _this3.replayVideo = el;\n          },\n          className: videoClassName,\n          src: this.state.videoUrl,\n          loop: true,\n          muted: isReplayVideoMuted,\n          playsInline: true,\n          autoPlay: !replayVideoAutoplayAndLoopOff,\n          controls: showReplayControls,\n          onClick: this.handleReplayVideoClick,\n          onDurationChange: this.handleDurationChange,\n          controlsList: videoControlsList,\n          disablePictureInPicture: disablePictureInPicture\n        }), videoInput);\n      }\n\n      if (shouldUseVideoInput) {\n        return renderVideoInputView({\n          videoInput: videoInput\n        });\n      }\n\n      if (!isInlineRecordingSupported) {\n        return renderUnsupportedView();\n      }\n\n      if (thereWasAnError) {\n        return renderErrorView({\n          error: error\n        });\n      }\n\n      if (isCameraOn) {\n        // Enable switch camera button, only if not recording and multiple video sources available\n        var switchCameraControl = availableDeviceIds && availableDeviceIds.length >= 2 && !isRecording ? /*#__PURE__*/_react[\"default\"].createElement(_switchCameraView[\"default\"], {\n          onClick: this.handleSwitchCamera\n        }) : null;\n        return /*#__PURE__*/_react[\"default\"].createElement(CameraView, {\n          key: \"camera\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(Video, {\n          isFlipped: this.props.isFlipped,\n          ref: function ref(el) {\n            return _this3.cameraVideo = el;\n          },\n          autoPlay: true,\n          muted: true,\n          playsInline: true\n        }), switchCameraControl);\n      }\n\n      if (isConnecting) {\n        return renderLoadingView();\n      }\n\n      return renderDisconnectedView();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$state3 = this.state,\n          isVideoInputSupported = _this$state3.isVideoInputSupported,\n          isInlineRecordingSupported = _this$state3.isInlineRecordingSupported,\n          thereWasAnError = _this$state3.thereWasAnError,\n          isRecording = _this$state3.isRecording,\n          isCameraOn = _this$state3.isCameraOn,\n          streamIsReady = _this$state3.streamIsReady,\n          isConnecting = _this$state3.isConnecting,\n          isRunningCountdown = _this$state3.isRunningCountdown,\n          isReplayingVideo = _this$state3.isReplayingVideo,\n          isReplayVideoMuted = _this$state3.isReplayVideoMuted;\n      var _this$props3 = this.props,\n          countdownTime = _this$props3.countdownTime,\n          timeLimit = _this$props3.timeLimit,\n          showReplayControls = _this$props3.showReplayControls,\n          replayVideoAutoplayAndLoopOff = _this$props3.replayVideoAutoplayAndLoopOff,\n          renderActions = _this$props3.renderActions,\n          t = _this$props3.t,\n          useVideoInput = _this$props3.useVideoInput,\n          wrapperClassName = _this$props3.wrapperClassName;\n      return /*#__PURE__*/_react[\"default\"].createElement(Wrapper, {\n        className: wrapperClassName\n      }, this.renderCameraView(), renderActions({\n        t: t,\n        isVideoInputSupported: isVideoInputSupported,\n        isInlineRecordingSupported: isInlineRecordingSupported,\n        thereWasAnError: thereWasAnError,\n        isRecording: isRecording,\n        isCameraOn: isCameraOn,\n        streamIsReady: streamIsReady,\n        isConnecting: isConnecting,\n        isRunningCountdown: isRunningCountdown,\n        isReplayingVideo: isReplayingVideo,\n        isReplayVideoMuted: isReplayVideoMuted,\n        countdownTime: countdownTime,\n        timeLimit: timeLimit,\n        showReplayControls: showReplayControls,\n        replayVideoAutoplayAndLoopOff: replayVideoAutoplayAndLoopOff,\n        useVideoInput: useVideoInput,\n        onTurnOnCamera: function onTurnOnCamera() {\n          return _this4.turnOnCamera();\n        },\n        onSwitchCamera: this.handleSwitchCamera,\n        onTurnOffCamera: this.turnOffCamera,\n        onOpenVideoInput: this.handleOpenVideoInput,\n        onStartRecording: this.handleStartRecording,\n        onStopRecording: this.handleStopRecording,\n        onPauseRecording: this.handlePauseRecording,\n        onResumeRecording: this.handleResumeRecording,\n        onStopReplaying: this.handleStopReplaying\n      }));\n    }\n  }]);\n\n  return VideoRecorder;\n}(_react.Component);\n\nexports[\"default\"] = VideoRecorder;\n\n_defineProperty(VideoRecorder, \"propTypes\", {\n  /** Whether or not to start the camera initially */\n  isOnInitially: _propTypes[\"default\"].bool,\n\n  /** Whether or not to display the video flipped (makes sense for user facing camera) */\n  isFlipped: _propTypes[\"default\"].bool,\n\n  /** Pass this if you want to force a specific mime-type for the video */\n  mimeType: _propTypes[\"default\"].string,\n\n  /** How much time to wait until it starts recording (in ms) */\n  countdownTime: _propTypes[\"default\"].number,\n\n  /** Use this if you want to set a time limit for the video (in ms) */\n  timeLimit: _propTypes[\"default\"].number,\n\n  /** Use this if you want to show play/pause/etc. controls on the replay video */\n  showReplayControls: _propTypes[\"default\"].bool,\n\n  /** Use this to turn off autoplay and looping of the replay video. It is recommended to also showReplayControls in order to play */\n  replayVideoAutoplayAndLoopOff: _propTypes[\"default\"].bool,\n\n  /** Use this if you want to customize the constraints passed to getUserMedia() */\n  constraints: _propTypes[\"default\"].shape({\n    audio: _propTypes[\"default\"].any,\n    video: _propTypes[\"default\"].any\n  }),\n  chunkSize: _propTypes[\"default\"].number,\n  dataAvailableTimeout: _propTypes[\"default\"].number,\n  useVideoInput: _propTypes[\"default\"].bool,\n\n  /** Use this to configure the replaying video element's controlslist attribute */\n  videoControlsList: _propTypes[\"default\"].string,\n\n  /** Use this to disable picture in picture mode on the replaying video element */\n  disablePictureInPicture: _propTypes[\"default\"].bool,\n  renderDisconnectedView: _propTypes[\"default\"].func,\n  renderLoadingView: _propTypes[\"default\"].func,\n  renderVideoInputView: _propTypes[\"default\"].func,\n  renderUnsupportedView: _propTypes[\"default\"].func,\n  renderErrorView: _propTypes[\"default\"].func,\n  renderActions: _propTypes[\"default\"].func,\n  cameraViewClassName: _propTypes[\"default\"].string,\n  videoClassName: _propTypes[\"default\"].string,\n  wrapperClassName: _propTypes[\"default\"].string,\n\n  /** Use this to localize the texts */\n  t: _propTypes[\"default\"].func,\n  onCameraOn: _propTypes[\"default\"].func,\n  onTurnOnCamera: _propTypes[\"default\"].func,\n  onSwitchCamera: _propTypes[\"default\"].func,\n  onTurnOffCamera: _propTypes[\"default\"].func,\n  onStartRecording: _propTypes[\"default\"].func,\n  onStopRecording: _propTypes[\"default\"].func,\n  onPauseRecording: _propTypes[\"default\"].func,\n  onResumeRecording: _propTypes[\"default\"].func,\n  onRecordingComplete: _propTypes[\"default\"].func,\n  onOpenVideoInput: _propTypes[\"default\"].func,\n  onStopReplaying: _propTypes[\"default\"].func,\n  onError: _propTypes[\"default\"].func\n});\n\n_defineProperty(VideoRecorder, \"defaultProps\", {\n  renderUnsupportedView: function renderUnsupportedView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_unsupportedView[\"default\"], null);\n  },\n  renderErrorView: function renderErrorView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_errorView[\"default\"], null);\n  },\n  renderVideoInputView: function renderVideoInputView(_ref2) {\n    var videoInput = _ref2.videoInput;\n    return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, videoInput);\n  },\n  renderDisconnectedView: function renderDisconnectedView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_disconnectedView[\"default\"], null);\n  },\n  renderLoadingView: function renderLoadingView() {\n    return /*#__PURE__*/_react[\"default\"].createElement(_loadingView[\"default\"], null);\n  },\n  t: function t(x) {\n    return x;\n  },\n  renderActions: _renderActions[\"default\"],\n  isFlipped: true,\n  countdownTime: 3000,\n  constraints: CONSTRAINTS,\n  chunkSize: 250,\n  dataAvailableTimeout: 500\n});"]},"metadata":{},"sourceType":"script"}